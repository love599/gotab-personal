const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/shareSay-7qjo2Hy3.js","assets/main-DoQmQ3rA.js","assets/main-BFqYArpd.css"])))=>i.map(i=>d[i]);
import{r as e,I as t,c as a,i as s,k as n,j as l,F as i,w as r,L as o,D as c,ap as d,aq as h,B as m,E as u,G as p,z as f,C as x,H as j,am as y,ai as g,t as S,af as b,dV as _,O as v,f3 as C,d as k,J as w,N as I,f4 as D,f5 as N,au as O,ae as E,f6 as A,aE as Y,bI as H,cb as P,m as F,aa as L,l as T,ab as V,f7 as z,ag as M,a8 as U}from"./main-DoQmQ3rA.js";import{N as $}from"./noPermissions-Cyk_sFWh.js";import{E as B}from"./index-BbyVGnvZ.js";import{C as R,S as q}from"./SyncOutlined-Bty6z6Gu.js";import"./StepBackwardOutlined-DpwJRxU8.js";function G(){return G=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},G.apply(this,arguments)}const J=(a,s)=>e.createElement(t,G({},a,{ref:s,icon:R})),Z=e.forwardRef(J);function K(){return K=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},K.apply(this,arguments)}const Q=(a,s)=>e.createElement(t,K({},a,{ref:s,icon:q})),W=e.forwardRef(Q);function X(){d.hide(h)}function ee(e){return{label:e.label,value:e.id}}function te(e){return e.user.token}function ae(e){return e.appData.listData}const se=e.memo(function(t){const p=a.c(37),[f]=s(),{type:x,initialValues:j,setShareSettingData:y,setHasShare:g}=t,S=n(ae),b=n(te),[_,v]=e.useState(!1);let C;p[0]!==y||p[1]!==b?(C=function(e){v(!0),e.privateCategoryIds&&(e.privateCategoryIds=e.privateCategoryIds.join(",")),c({url:u.editShareSetting,data:e,token:b}).then(e=>{200===e.code&&e.data&&(y&&y(e.data),d.hide(h))}).finally(()=>{v(!1)})},p[0]=y,p[1]=b,p[2]=C):C=p[2];const k=C;let w;p[3]!==g||p[4]!==y||p[5]!==b?(w=function(e){v(!0),e.privateCategoryIds&&(e.privateCategoryIds=e.privateCategoryIds.join(",")),c({url:u.addShareSetting,data:e,token:b}).then(e=>{200===e.code&&e.data&&(y&&y(e.data),g&&g(!0),d.hide(h))}).finally(()=>{v(!1)})},p[3]=g,p[4]=y,p[5]=b,p[6]=w):w=p[6];const I=w;let D;p[7]!==f||p[8]!==j||p[9]!==S?(D=function(){if(!j||!j.privateCategoryIds)return;const e=[];j.privateCategoryIds.forEach(t=>{const a=S?.find(e=>e.id===t);a&&e.push(a.id)}),f.setFieldValue("privateCategoryIds",e)},p[7]=f,p[8]=j,p[9]=S,p[10]=D):D=p[10];const N=D;let O,E,A,Y,H,P,F,L,T,V,z;p[11]!==N?(O=()=>{N()},p[11]=N,p[12]=O):O=p[12],p[13]===Symbol.for("react.memo_cache_sentinel")?(E=[],p[13]=E):E=p[13],e.useEffect(O,E),p[14]===Symbol.for("react.memo_cache_sentinel")?(A={flex:"72px"},p[14]=A):A=p[14],p[15]!==I||p[16]!==k||p[17]!==x?(Y=e=>{"edit"===x?k(e):I(e)},p[15]=I,p[16]=k,p[17]=x,p[18]=Y):Y=p[18],p[19]===Symbol.for("react.memo_cache_sentinel")?(H=[{validator:(e,t)=>t&&""!==t?t&&!/^[a-zA-Z0-9]+$/.test(t)?Promise.reject("分享码仅限数字和英文"):Promise.resolve():Promise.reject("请输入分享码")}],p[19]=H):H=p[19],p[20]===Symbol.for("react.memo_cache_sentinel")?(P=l.jsx(i.Item,{label:"分享码",required:!0,rules:H,name:"path",children:l.jsx(r,{placeholder:"分享码",allowClear:!0,maxLength:50})}),p[20]=P):P=p[20],p[21]===Symbol.for("react.memo_cache_sentinel")?(F=l.jsx(i.Item,{name:"title",label:"标题名称",children:l.jsx(r,{placeholder:"分享页标题",allowClear:!0,maxLength:50})}),p[21]=F):F=p[21],p[22]===Symbol.for("react.memo_cache_sentinel")?(L=l.jsx(i.Item,{name:"description",label:"描述简介",children:l.jsx(r,{placeholder:"分享页描述",allowClear:!0,maxLength:200})}),p[22]=L):L=p[22],p[23]!==S?(T=S?.map(ee),p[23]=S,p[24]=T):T=p[24],p[25]!==T?(V=l.jsx(i.Item,{name:"privateCategoryIds",label:"私有分类",children:l.jsx(o,{mode:"multiple",placeholder:"私有分类，分享时隐藏",options:T,allowClear:!0})}),p[25]=T,p[26]=V):V=p[26],p[27]===Symbol.for("react.memo_cache_sentinel")?(z=l.jsx(m,{onClick:X,children:"取消"}),p[27]=z):z=p[27];const M="edit"===x?"保存":"创建";let U,$;return p[28]!==_||p[29]!==M?(U=l.jsxs("div",{className:"flex justify-end gap-3 flex-wrap",children:[z,l.jsx(m,{loading:_,htmlType:"submit",type:"primary",children:M})]}),p[28]=_,p[29]=M,p[30]=U):U=p[30],p[31]!==f||p[32]!==j||p[33]!==V||p[34]!==U||p[35]!==Y?($=l.jsx(l.Fragment,{children:l.jsxs(i,{form:f,initialValues:j,autoComplete:"off",labelCol:A,onFinish:Y,children:[P,F,L,V,U]})}),p[31]=f,p[32]=j,p[33]=V,p[34]=U,p[35]=Y,p[36]=$):$=p[36],$});function ne(){d.hide(h)}function le(e){return l.jsx(g,{content:e,replace:!1})}function ie(e){return e.user.token}const re=e.memo(function(t){const s=a.c(34),{shareSettingData:i,setShareSettingData:r}=t,[o,g]=e.useState(i.share_say),S=n(ie);let b;s[0]===Symbol.for("react.memo_cache_sentinel")?(b=[],s[0]=b):b=s[0];const[_,v]=e.useState(b);let C;s[1]!==S?(C=function(e){return new Promise(t=>{c({url:u.uploadImage,token:S,data:p({file:e})}).then(e=>{200===e.code&&e.data&&t(e.data.image_url)})})},s[1]=S,s[2]=C):C=s[2];const k=C;let w;s[3]!==o||s[4]!==r||s[5]!==i||s[6]!==S?(w=function(){o?(x(0,v),c({url:u.editShareSay,data:{shareSay:o},token:S}).then(e=>{200===e.code&&(r&&r({...i,share_say:o}),d.hide(h))}).finally(()=>{j(0,v)})):f.error("请输入分享有话的内容")},s[3]=o,s[4]=r,s[5]=i,s[6]=S,s[7]=w):w=s[7];const I=w;let D;s[8]!==r||s[9]!==i||s[10]!==S?(D=function(){x(1,v),c({url:u.resetShareSay,token:S}).then(e=>{200===e.code&&r&&(r({...i,share_say:""}),g(""))}).finally(()=>{j(1,v)})},s[8]=r,s[9]=i,s[10]=S,s[11]=D):D=s[11];const N=D;let O,E,A,Y,H,P,F,L,T,V;return s[12]===Symbol.for("react.memo_cache_sentinel")?(O={height:"calc(100% - 44px)"},E=e=>{g(e.text)},s[12]=O,s[13]=E):(O=s[12],E=s[13]),s[14]!==k||s[15]!==o?(A=l.jsx(B,{className:"flex-1",style:O,onChange:E,value:o,renderHTML:le,onImageUpload:k}),s[14]=k,s[15]=o,s[16]=A):A=s[16],s[17]!==_[1]?(Y=l.jsx(m,{danger:!0,loading:_[1],children:"重置"}),s[17]=_[1],s[18]=Y):Y=s[18],s[19]!==N||s[20]!==Y?(H=l.jsx(y,{title:"是否确认重置？",onConfirm:N,children:Y}),s[19]=N,s[20]=Y,s[21]=H):H=s[21],s[22]===Symbol.for("react.memo_cache_sentinel")?(P=l.jsx(m,{onClick:ne,children:"取消"}),s[22]=P):P=s[22],s[23]!==I?(F=()=>{I()},s[23]=I,s[24]=F):F=s[24],s[25]!==_[0]||s[26]!==F?(L=l.jsx(m,{loading:_[0],type:"primary",onClick:F,children:"保存"}),s[25]=_[0],s[26]=F,s[27]=L):L=s[27],s[28]!==L||s[29]!==H?(T=l.jsxs("div",{className:"flex justify-end gap-3 flex-wrap",children:[H,P,L]}),s[28]=L,s[29]=H,s[30]=T):T=s[30],s[31]!==T||s[32]!==A?(V=l.jsxs("div",{className:"flex flex-col gap-3 h-full",children:[A,T]}),s[31]=T,s[32]=A,s[33]=V):V=s[33],V}),oe=E.lazy(()=>M(()=>import("./shareSay-7qjo2Hy3.js"),__vite__mapDeps([0,1,2])));function ce(){const t=a.c(28),{token:s}=S.useToken(),i=n(me);let r;t[0]===Symbol.for("react.memo_cache_sentinel")?(r=[],t[0]=r):r=t[0];const[o,p]=e.useState(r),f=n(he),g=n(de);let E;t[1]===Symbol.for("react.memo_cache_sentinel")?(E={path:"",title:"",description:"",CreatedAt:"",status:0,share_say:"",private_category_ids:"",UpdatedAt:""},t[1]=E):E=t[1];const[M,B]=e.useState(E),[R,q]=e.useState(!1);let G;t[2]!==i?(G=function(){i&&(x(0,p),U({url:u.getUserShare,token:i}).then(e=>{200===e.code&&e.data?(B(e.data),q(!0)):q(!1)}).finally(()=>{j(0,p)}))},t[2]=i,t[3]=G):G=t[3];const J=G;let K,Q,X;t[4]!==J?(K=()=>{J()},t[4]=J,t[5]=K):K=t[5],t[6]===Symbol.for("react.memo_cache_sentinel")?(Q=[],t[6]=Q):Q=t[6],e.useLayoutEffect(K,Q),t[7]!==M||t[8]!==i?(X=function(){x(1,p),c({url:u.enableShare,token:i}).then(e=>{200===e.code&&B({...M,status:1})}).finally(()=>{j(1,p)})},t[7]=M,t[8]=i,t[9]=X):X=t[9];const ee=X;let te;t[10]!==M||t[11]!==i?(te=function(){x(2,p),c({url:u.disableShare,token:i}).then(e=>{200===e.code&&B({...M,status:2})}).finally(()=>{j(2,p)})},t[10]=M,t[11]=i,t[12]=te):te=t[12];const ae=te;let ne;t[13]!==i?(ne=function(){x(3,p),c({url:u.deleteShare,token:i}).then(e=>{200===e.code&&(B({path:"",title:"",description:"",CreatedAt:"",status:0,share_say:"",private_category_ids:"",UpdatedAt:""}),q(!1))}).finally(()=>{j(3,p)})},t[13]=i,t[14]=ne):ne=t[14];const le=ne;let ie;t[15]!==f?(ie=function(e){if(!e)return;const t=e.split(","),a=[];return t.forEach(e=>{const t=f?.find(t=>t.id===e);t&&a.push(t.label)}),a.join("，")},t[15]=f,t[16]=ie):ie=t[16];const ce=ie;let ue;return t[17]!==g||t[18]!==le||t[19]!==ae||t[20]!==ee||t[21]!==ce||t[22]!==R||t[23]!==o||t[24]!==M||t[25]!==s||t[26]!==i?(ue=i?o[0]?l.jsx(b,{}):R?l.jsxs(l.Fragment,{children:[l.jsx(_,{message:"分享有话是以弱化提醒的方式展示在分享页的右上角抽屉中，支持自主自定义markdown显示内容！考虑性能，分享数据将缓存 5 分钟",type:"info",icon:l.jsx(v,{})}),l.jsx(C,{bordered:!0,column:1,className:"w-full",styles:{label:{padding:"8px 16px"},content:{padding:"8px 16px",textAlign:"end"}},items:[{label:"分享状态",children:l.jsx(w,{title:0===M.status?"请联系管理员或耐心等待审核通过":1===M.status?"您的分享页可正常访问":2===M.status?"您的分享页已暂停分享":3===M.status?"您的分享页因违规已被禁用":"",children:l.jsx(I,{className:"m-0 cursor-pointer",icon:l.jsx(v,{}),color:0===M.status?"default":1===M.status?"green":2===M.status?"orange":"red",children:0===M.status?"待审核":1===M.status?"正常":2===M.status?"已停用":"被禁用"})})},{label:"分享路径",children:M?.path?l.jsx("div",{className:"flex justify-end",children:l.jsx(m,{onClick:()=>{window.open(D+"/s/"+M?.path)},type:"link",size:"small",className:"min-h-[22px] h-full text-wrap p-0",children:l.jsx("span",{className:"text-end",children:D+"/s/"+M?.path||"-"})})}):"-"},{label:"私有分类",children:M.private_category_ids?ce(M.private_category_ids):"-"},{label:"分享页标题",children:M?.title||"-"},{label:"分享页描述",children:M?.description||"-"},{label:"分享有话",children:M.share_say?l.jsx("div",{className:"flex justify-end",children:l.jsx(m,{disabled:3===M.status,onClick:()=>{d.show(O,{title:"分享有话",backgroundOpacity:g?.92:void 0,children:l.jsx(e.Suspense,{children:l.jsx(oe,{content:M.share_say||""})}),placement:"right"})},type:"link",className:"p-0 h-[22px]",size:"small",icon:l.jsx(N,{}),children:"预览"})}):"-"},{label:"创建时间",children:k(M?.CreatedAt).format("YYYY-MM-DD HH:mm:ss")||"-"},{label:"更新时间",children:k(M?.UpdatedAt).format("YYYY-MM-DD HH:mm:ss")||"-"}]}),3===M.status?null:l.jsxs("div",{className:"flex flex-col mt-3 gap-3",children:[l.jsxs("div",{className:"flex gap-1 font-medium pl-2",style:{color:s.colorTextDescription},children:[l.jsx(Z,{}),l.jsx("p",{children:"控制台"})]}),l.jsx(m,{onClick:()=>{const e=""+(D+"/s/"+M?.path),t=M?.title,a=M?.description;Y(`我的个性分享页：${e}${t?"（"+t+"）":""}${a?"，主要内容："+a:""}`)},icon:l.jsx(A,{}),children:"复制文案"}),l.jsx(m,{icon:l.jsx(H,{}),onClick:()=>{d.show(h,{title:"有话设置",width:"860px",height:"520px",children:l.jsx(re,{shareSettingData:M,setShareSettingData:B})})},children:"有话设置"}),l.jsx(m,{icon:l.jsx(P,{}),onClick:()=>{d.show(h,{title:"编辑分享信息",children:l.jsx(se,{type:"edit",initialValues:{path:M.path,title:M.title,description:M.description,privateCategoryIds:M.private_category_ids.split(",")},setShareSettingData:B})})},children:"编辑信息"}),1===M.status?l.jsx(m,{onClick:ae,loading:o[2],icon:l.jsx(F,{}),children:"暂停分享"}):2===M.status?l.jsx(m,{onClick:ee,loading:o[1],icon:l.jsx(W,{}),children:"启用分享"}):null,l.jsx(y,{title:"是否确认删除？",onConfirm:le,children:l.jsx(m,{danger:!0,icon:l.jsx(L,{}),loading:o[3],children:"删除分享"})})]})]}):l.jsx(l.Fragment,{children:l.jsx(T,{className:"flex flex-col items-center w-full px-0",icon:l.jsx("div",{className:"h-[240px]",children:l.jsx("img",{alt:"",src:z,style:{width:"auto",height:"240px"}})}),title:l.jsx("div",{className:"flex justify-center w-full",children:l.jsx(m,{onClick:()=>{d.show(h,{title:"创建分享页",children:l.jsx(se,{type:"add",setShareSettingData:B,setHasShare:q})})},icon:l.jsx(V,{}),type:"primary",children:"创建分享页"})})})}):l.jsx($,{title:"权限不足",subTitle:"请您先完成登录/注册",extra:!1}),t[17]=g,t[18]=le,t[19]=ae,t[20]=ee,t[21]=ce,t[22]=R,t[23]=o,t[24]=M,t[25]=s,t[26]=i,t[27]=ue):ue=t[27],ue}function de(e){return e.card.bgBackdropFilter}function he(e){return e.appData.listData}function me(e){return e.user.token}export{ce as default};
