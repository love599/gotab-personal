let t,e;chrome.runtime.onMessage.addListener(function(n,o,a){if("fetchbaidu"==n.todo){t&&t.abort(),t=new AbortController;const e=t.signal,o=n.searchContent;fetch(`https://www.baidu.com/sugrec?prod=pc&from=pc_web&wd=${o}`,{method:"GET",signal:e}).then(t=>t.json()).then(t=>{let e=t.g,n=[];for(let o=0;o<e.length;o++){let t={key:o,label:e[o].q};n.push(t)}0!==n.length?a(n):a([])}).catch(function(t){a([])})}if("getWebsiteInfo"===n.todo){e&&e.abort(),e=new AbortController;const t=e.signal,o=n.url;try{fetch(o,{method:"GET",signal:t}).then(t=>t.text()).then(t=>{a(t)}).catch(function(t){a(t)})}catch(c){a(c)}}if("uploadIcon"===n.todo){const t=n.icon,e="https://web.gotab.cn",o="api/tools/uploadFavicon",h=e.endsWith("/")?e+o:e+"/"+o,s=/^\s*data:([a-z]+\/[a-z0-9-+.]+(;[a-z-]+=[a-z0-9-]+)?)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s]*?)\s*$/i;try{s.test(t)?fetch(h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({faviconUrl:t})}).then(t=>t.json()).then(t=>{a(t)}).catch(t=>{a(t)}):fetch(t).then(t=>t.blob()).then(t=>{const e=new FileReader;e.readAsDataURL(t),e.onload=function(){const t=e.result;s.test(t)?fetch(h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({faviconUrl:t})}).then(t=>t.json()).then(t=>{a(t)}).catch(function(){a(null)}):a(null)}}).catch(t=>{a(t)})}catch(c){a(c)}}return!0});
