import{r as e,e as t,c as o,u as r,k as n,t as l,bU as a,d0 as s,d1 as c,j as i,w as d,ax as u,o as f,d2 as m,d3 as g,q as x,d4 as p,d5 as b,d6 as h,a1 as k,d7 as w}from"./main-ByGnKrSs.js";function y(e){const o=t.getState().card.gridColumnWidth,r=t.getState().card.gridRowHeight,n=e*(t.getState().card.radius/Math.min(r,o)),l=e/2;return Math.min(n,l)}function v(e,o){const r=t.getState().card.gridColumnWidth,n=t.getState().card.gridRowHeight;return e*(o/Math.min(n,r))}const j=e.memo(()=>{const f=o.c(28),m=r(),[g,x]=e.useState(!1),[y,v]=e.useState(!1),[j,D]=e.useState("");let N;f[0]===Symbol.for("react.memo_cache_sentinel")?(N=[],f[0]=N):N=f[0];const[E,L]=e.useState(N),[R,B]=e.useState(0),I=n(C),{token:M}=l.useToken(),A=e.useRef(null),H=e.useRef(null);let z,F,W;f[1]!==m||f[2]!==y?(z=()=>{y?(m(p(!1)),m(b(!1)),localStorage.setItem("globalSearchIsOpen","1")):(localStorage.removeItem("globalSearchIsOpen"),D(""),B(0))},F=[y,m],f[1]=m,f[2]=y,f[3]=z,f[4]=F):(z=f[3],F=f[4]),e.useEffect(z,F),f[5]===Symbol.for("react.memo_cache_sentinel")?(W=async o=>{if("string"!=typeof o)throw new Error("无效的关键词，请您提供有效的文本");if(!o)return void L([]);const r=t.getState().appData.listData,n=t.getState().appData.freeDragListData,l=[...h(r.concat(n)),...k()?await w():[]],a=new Set,s=l.filter(e=>"link"===e.type&&!a.has(e.link)&&(a.add(e.link),!0)).filter(e=>{if("link"===e.type&&e.label&&e.link){const t=e.label.trim().toLowerCase(),r=e.link.trim().toLowerCase();return t.includes(o.toLowerCase())||r.includes(o.toLowerCase())}return!1});e.startTransition(()=>{L(s.slice(0,9))})},f[5]=W):W=f[5];const P=W;let K,O,U,$;f[6]!==j?(K=()=>{""!==j.trim()?P(j.trim()):L([])},O=[j,P],f[6]=j,f[7]=K,f[8]=O):(K=f[7],O=f[8]),a(K,O),f[9]===Symbol.for("react.memo_cache_sentinel")?(U=()=>{const e=e=>{(e.ctrlKey||e.metaKey)&&"f"===e.key&&(e.preventDefault(),v(!0),setTimeout(()=>x(!0),10))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},$=[],f[9]=U,f[10]=$):(U=f[9],$=f[10]),e.useEffect(U,$);const q=T,V=_;let G;f[11]===Symbol.for("react.memo_cache_sentinel")?(G=(e,t,o,r)=>{const{row:n,col:l}=V(e,o),a=Math.ceil(r/o);if("up"===t){const e=(0===n?a-1:n-1)*o+l;return e>=r?l:e}if("down"===t){const e=(n+1)%a*o+l;return e>=r?l:e}return e},f[11]=G):G=f[11];const J=G;let Q,X,Y;f[12]!==E||f[13]!==R||f[14]!==g?(X=()=>{if(!g||0===E.length)return;const e=e=>{const t=H.current;if(!t)return;const o=E.length,r=q(t);let n=R;e:switch(e.key){case"ArrowUp":e.preventDefault(),n=J(R,"up",r,o);break e;case"ArrowDown":e.preventDefault(),n=J(R,"down",r,o);break e;case"ArrowLeft":e.preventDefault(),n=(R-1+o)%o;break e;case"ArrowRight":e.preventDefault(),n=(R+1)%o;break e;case"Enter":R>=0&&window.open(E[R].link,"_blank");break e;default:return}B(n);const l=t.children[n];l&&l.scrollIntoView({block:"nearest",behavior:"smooth"})};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},Q=[g,E,R],f[12]=E,f[13]=R,f[14]=g,f[15]=Q,f[16]=X):(Q=f[15],X=f[16]),e.useEffect(X,Q),f[17]===Symbol.for("react.memo_cache_sentinel")?(Y=()=>{x(!1),setTimeout(()=>v(!1),300)},f[17]=Y):Y=f[17];const Z=Y;let ee,te;return s(A,Z),c("Escape",Z),f[18]!==I||f[19]!==E||f[20]!==R||f[21]!==y||f[22]!==g||f[23]!==j||f[24]!==M?(ee=y&&i.jsx("div",{className:`fixed inset-0 z-[10000] flex py-20 px-6 justify-center bg-black bg-opacity-45 opacity-0 transition-opacity duration-200 ${g?"opacity-100":""} ${I?"backdrop-blur-sm":""}`,children:i.jsxs("div",{ref:A,className:"flex flex-col p-6 gap-4 w-full max-w-xl transform h-fit max-h-full rounded-2xl opacity-0 transition-all duration-200 "+(g?"opacity-100":""),style:{background:M.colorBgContainer,scale:g?1:.9},children:[i.jsx(d,{size:"large",autoFocus:!0,className:"border-2",placeholder:"全局搜索链接/书签卡片（ 显示前 9 个相关结果 ）",prefix:i.jsx(u,{}),value:j,onChange:e=>{D(e.target.value),B(0)}}),i.jsx("div",{className:"h-full overflow-y-auto",children:E.length>0?i.jsx("div",{ref:H,className:"grid *:cursor-pointer *:transition-all *:duration-200 *:rounded-xl",style:{gridTemplateColumns:"repeat(auto-fill, minmax(160px, 1fr))",gap:"12px",gridAutoRows:"68px"},children:E.map((e,t)=>i.jsx(S,{result:e,index:t,currentIndex:R},e.id))}):i.jsx("div",{className:"p-6 pb-5 text-center",style:{color:M.colorTextDescription},children:j?"无搜索结果：请更换关键词":"请先输入您要搜索的关键词"})})]})}),f[18]=I,f[19]=E,f[20]=R,f[21]=y,f[22]=g,f[23]=j,f[24]=M,f[25]=ee):ee=f[25],f[26]!==ee?(te=i.jsx(i.Fragment,{children:ee}),f[26]=ee,f[27]=te):te=f[27],te}),S=e.memo(e=>{const t=o.c(46),{result:r,index:n,currentIndex:a}=e,{token:s}=l.useToken(),c=n===a,d=r.id,u=c?s.colorPrimary:s.colorBorder,p=c?s.colorPrimaryBgHover:void 0;let b,h,k,w;t[0]!==u||t[1]!==p?(b={minWidth:0,borderColor:u,backgroundColor:p},t[0]=u,t[1]=p,t[2]=b):b=t[2],t[3]!==c||t[4]!==s.colorBgTextHover?(h=e=>{c||(e.currentTarget.style.backgroundColor=s.colorBgTextHover)},t[3]=c,t[4]=s.colorBgTextHover,t[5]=h):h=t[5],t[6]!==c?(k=e=>{c||(e.currentTarget.style.backgroundColor="")},t[6]=c,t[7]=k):k=t[7],t[8]!==r.link?(w=()=>window.open(r.link,"_blank"),t[8]=r.link,t[9]=w):w=t[9];const j=r.backgroundColor;let S;t[10]===Symbol.for("react.memo_cache_sentinel")?(S=y(40),t[10]=S):S=t[10];const C=r.iconPadding||0;let T,_,N,E,L,R,B,I,M,A,H;return t[11]!==C?(T=v(40,C),t[11]=C,t[12]=T):T=t[12],t[13]!==r.backgroundColor||t[14]!==T?(_={backgroundColor:j,borderRadius:S,padding:T},t[13]=r.backgroundColor,t[14]=T,t[15]=_):_=t[15],t[16]!==r.fontColor||t[17]!==r.icon||t[18]!==r.innerlabel||t[19]!==r.label?(N=r.icon?r.icon.startsWith("/default/")?i.jsx(f,{style:{fontSize:24,color:r.fontColor}}):m(r.icon)?i.jsx("img",{src:x(r.icon),alt:r.label,style:{objectFit:"cover",borderRadius:y(25)},onError:D}):i.jsx(g,{icon:r.icon,className:"w-full h-full",fallback:i.jsx("img",{src:"/icons/default_image.svg",className:"w-full h-full object-contain"})}):i.jsx("span",{style:{fontSize:"10px",color:r.fontColor},className:"text-center font-medium",children:r.innerlabel||r.label}),t[16]=r.fontColor,t[17]=r.icon,t[18]=r.innerlabel,t[19]=r.label,t[20]=N):N=t[20],t[21]!==_||t[22]!==N?(E=i.jsx("div",{style:_,className:"w-10 h-10 flex items-center justify-center overflow-hidden",children:N}),t[21]=_,t[22]=N,t[23]=E):E=t[23],t[24]===Symbol.for("react.memo_cache_sentinel")?(L={width:"calc(100% - 48px)"},t[24]=L):L=t[24],t[25]!==s.colorText?(R={color:s.colorText},t[25]=s.colorText,t[26]=R):R=t[26],t[27]!==r.label||t[28]!==R?(B=i.jsx("div",{style:R,children:r.label}),t[27]=r.label,t[28]=R,t[29]=B):B=t[29],t[30]!==s.colorTextDescription?(I={color:s.colorTextDescription},t[30]=s.colorTextDescription,t[31]=I):I=t[31],t[32]!==r.link||t[33]!==I?(M=i.jsx("div",{className:"text-xs",style:I,children:r.link}),t[32]=r.link,t[33]=I,t[34]=M):M=t[34],t[35]!==B||t[36]!==M?(A=i.jsxs("div",{style:L,className:"font-medium *:truncate flex flex-col justify-evenly",children:[B,M]}),t[35]=B,t[36]=M,t[37]=A):A=t[37],t[38]!==r.id||t[39]!==E||t[40]!==A||t[41]!==b||t[42]!==h||t[43]!==k||t[44]!==w?(H=i.jsxs("div",{className:"p-3 border-2 flex gap-2 cursor-pointer transition-colors duration-200 rounded-xl",style:b,onMouseEnter:h,onMouseLeave:k,onClick:w,children:[E,A]},d),t[38]=r.id,t[39]=E,t[40]=A,t[41]=b,t[42]=h,t[43]=k,t[44]=w,t[45]=H):H=t[45],H});function C(e){return e.card.bgBackdropFilter}function T(e){const t=Array.from(e.children);if(0===t.length)return 1;let o=1;const r=t[0].offsetTop;for(let n=1;n<t.length&&t[n].offsetTop===r;n++)o++;return o}function _(e,t){return{row:Math.floor(e/t),col:e%t}}function D(e){e.target.src="/icons/bookmark.svg"}export{j as default,y as getScaleRadius,v as getTruePadding};
