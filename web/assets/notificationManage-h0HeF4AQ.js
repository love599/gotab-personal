import{c as e,ap as t,j as s,r as i,B as n,ac as l,O as a,a0 as o,ar as r,as as c,E as d,N as m,aq as u,F as h,w as f,C as x,e as j,D as y,H as p,at as k,al as _,au as b,av as g,ao as S,G as w,z as N}from"./main-BpZjJVsn.js";import{E as C}from"./index-DchRpIH4.js";import{M as v,R as I}from"./myTable-cE3aIfnr.js";import{C as T}from"./contentLayout-_uCr-R21.js";import{R as O}from"./ReloadOutlined-C_CB4W5U.js";import"./transformData-Ck-V4KL0.js";import"./MoneyCollectOutlined-BqqHq2uA.js";import"./MoneyCollectOutlined-4QlEwa2l.js";import"./index-BOYxyhzc.js";import"./AlipayOutlined-1OD3_sSS.js";import"./AlipayOutlined-tZM3mGx9.js";function z(){const i=e.c(21),{key:m,refresh:u}=t();let h,f,x,j,y,p;i[0]===Symbol.for("react.memo_cache_sentinel")?(h={title:"创建人",key:"username",width:160,fixed:"left",render:q},f={title:"状态",key:"status",width:80,render:F},x={title:"标题",key:"title",width:200},j={title:"内容",key:"content",width:400},y={type:"time",title:"创建时间",key:"notice_time",width:200},i[0]=h,i[1]=f,i[2]=x,i[3]=j,i[4]=y):(h=i[0],f=i[1],x=i[2],j=i[3],y=i[4]),i[5]!==u?(p=[h,f,x,j,y,{title:"操作",fixed:"right",width:220,render:(e,t)=>s.jsx(L,{record:t,refresh:u})}],i[5]=u,i[6]=p):p=i[6];const k=p;let _,b,g,S,w,N,C;return i[7]===Symbol.for("react.memo_cache_sentinel")?(_=s.jsx(O,{}),i[7]=_):_=i[7],i[8]!==u?(b=s.jsx(n,{type:"primary",icon:_,onClick:()=>{u()},children:"刷新列表"}),i[8]=u,i[9]=b):b=i[9],i[10]===Symbol.for("react.memo_cache_sentinel")?(g=s.jsx(l,{type:"warning",description:s.jsxs(s.Fragment,{children:[s.jsx(a,{className:"mr-1"}),"只会通知最新一条启用的公告！公告新增后需要二次确认是否发布，并且一天只可发布一次公告，以便保证用户体验！"]}),className:"mt-3 p-1 px-3 text-xs font-normal w-full"}),S=s.jsx(o,{className:"my-3"}),i[10]=g,i[11]=S):(g=i[10],S=i[11]),i[12]!==u?(w=s.jsx("div",{className:"mb-3",children:s.jsx(n,{type:"primary",onClick:()=>{r.show(c,{title:"新增公告",children:s.jsx(M,{refresh:u,type:"add"}),width:720})},children:"新增公告"})}),i[12]=u,i[13]=w):w=i[13],i[14]!==k||i[15]!==m?(N=s.jsx(v,{columns:k,getListUrl:d.getNoticeList,dataKey:"data.list",tableKey:m}),i[14]=k,i[15]=m,i[16]=N):N=i[16],i[17]!==w||i[18]!==N||i[19]!==b?(C=s.jsxs(T,{children:[b,g,S,w,N]}),i[17]=w,i[18]=N,i[19]=b,i[20]=C):C=i[20],C}function F(e){return s.jsx(m,{color:0===e?"blue":1===e?"green":"red",children:0===e?"待审核":1===e?"正常":"停用"})}function q(e){return s.jsx(m,{color:e?"geekblue":"red",bordered:!1,icon:s.jsx(u,{}),children:e||"已注销"})}const L=i.memo(t=>{const l=e.c(43),{record:a,refresh:o}=t;let m;l[0]===Symbol.for("react.memo_cache_sentinel")?(m=[],l[0]=m):m=l[0];const[u,h]=i.useState(m);let f;l[1]!==a.id||l[2]!==o?(f=function(){x(0,h);const e=j.getState().user.token;setTimeout(()=>{y({url:d.rejectNotice,token:e,data:{id:a.id}}).then(e=>{200===e?.code&&o()}).finally(()=>{p(0,h)})},500)},l[1]=a.id,l[2]=o,l[3]=f):f=l[3];const w=f;let N;l[4]!==a.id||l[5]!==o?(N=function(){x(0,h);const e=j.getState().user.token;setTimeout(()=>{y({url:d.confirmNotice,token:e,data:{id:a.id}}).then(e=>{200===e?.code&&o()}).finally(()=>{p(0,h)})},500)},l[4]=a.id,l[5]=o,l[6]=N):N=l[6];const C=N;let v;l[7]!==a.id||l[8]!==o?(v=function(){x(1,h);const e=j.getState().user.token;setTimeout(()=>{y({url:d.deleteNotice,token:e,data:{id:a.id}}).then(e=>{200===e?.code&&o()}).finally(()=>{p(1,h)})},500)},l[7]=a.id,l[8]=o,l[9]=v):v=l[9];const T=v;let O;l[10]!==a.content||l[11]!==a.title?(O=function(){k.open({closeIcon:s.jsx("div",{className:"my-handle-icon",children:s.jsx(b,{icon:s.jsx(g,{})})}),message:a.title,description:s.jsx(_,{content:a.content}),duration:null})},l[10]=a.content,l[11]=a.title,l[12]=O):O=l[12];const z=O;let F,q;l[13]!==z?(F=s.jsx(n,{type:"link",size:"small",onClick:z,children:"预览"}),l[13]=z,l[14]=F):F=l[14],l[15]!==a||l[16]!==o?(q=s.jsx(n,{type:"link",size:"small",onClick:()=>{r.show(c,{title:"编辑公告",children:s.jsx(M,{editItem:a,type:"edit",refresh:o}),width:720})},children:"编辑"}),l[15]=a,l[16]=o,l[17]=q):q=l[17];const L=0===a.status||2===a.status?"是否确认发布？":"是否确认停用？",R=0===a.status||2===a.status?C:w;let A,D,E,H,K,U,B,G,P;return l[18]===Symbol.for("react.memo_cache_sentinel")?(A={width:"44px"},l[18]=A):A=l[18],l[19]!==u[0]||l[20]!==a.status?(D=u[0]?s.jsx(I,{}):0===a.status||2===a.status?"发布":"停用",l[19]=u[0],l[20]=a.status,l[21]=D):D=l[21],l[22]!==u[0]||l[23]!==D?(E=s.jsx(n,{type:"link",size:"small",disabled:u[0],style:A,children:D}),l[22]=u[0],l[23]=D,l[24]=E):E=l[24],l[25]!==E||l[26]!==L||l[27]!==R?(H=s.jsx(S,{title:L,onConfirm:R,children:E}),l[25]=E,l[26]=L,l[27]=R,l[28]=H):H=l[28],l[29]===Symbol.for("react.memo_cache_sentinel")?(K={width:"44px"},l[29]=K):K=l[29],l[30]!==u[1]?(U=u[1]?s.jsx(I,{}):"删除",l[30]=u[1],l[31]=U):U=l[31],l[32]!==u[1]||l[33]!==U?(B=s.jsx(n,{danger:!0,type:"link",size:"small",disabled:u[1],style:K,children:U}),l[32]=u[1],l[33]=U,l[34]=B):B=l[34],l[35]!==T||l[36]!==B?(G=s.jsx(S,{title:"是否确认删除？",onConfirm:T,children:B}),l[35]=T,l[36]=B,l[37]=G):G=l[37],l[38]!==H||l[39]!==G||l[40]!==F||l[41]!==q?(P=s.jsxs("div",{className:"flex flex-wrap",children:[F,q,H,G]}),l[38]=H,l[39]=G,l[40]=F,l[41]=q,l[42]=P):P=l[42],P}),M=t=>{const l=e.c(23),{editItem:a,refresh:o,type:m}=t,u=void 0===m?"add":m,[x]=h.useForm(),[p,k]=i.useState(!1),[_,b]=i.useState(a?.content);let g;l[0]===Symbol.for("react.memo_cache_sentinel")?(g=function(e){const t=j.getState().user.token;return new Promise(s=>{y({url:d.uploadImage,token:t,data:w({file:e})}).then(e=>{200===e?.code&&e.data&&s(e.data.image_url)})})},l[0]=g):g=l[0];const S=g;let v;l[1]!==a?.id||l[2]!==_||l[3]!==o||l[4]!==u?(v=function(e){const t=j.getState().user.token;if(!_.trim())return void N.error("请输入公告内容");const s={title:e.title,content:_};k(!0),setTimeout(()=>{y({url:"add"===u?d.addNotice:d.editNotice,token:t,data:"add"===u?s:{id:a?.id,...s}}).then(e=>{200===e?.code&&(o(),r.hide(c))}).finally(()=>{k(!1)})},500)},l[1]=a?.id,l[2]=_,l[3]=o,l[4]=u,l[5]=v):v=l[5];const I=v;let T,O,z,F,q,L,M;l[6]===Symbol.for("react.memo_cache_sentinel")?(T={flex:"82px"},l[6]=T):T=l[6],l[7]===Symbol.for("react.memo_cache_sentinel")?(O=s.jsx(h.Item,{name:"title",label:"公告标题",required:!0,rules:[{required:!0}],children:s.jsx(f,{placeholder:"公告标题"})}),z=s.jsx(h.Item,{label:"公告内容",required:!0}),l[7]=O,l[8]=z):(O=l[7],z=l[8]),l[9]===Symbol.for("react.memo_cache_sentinel")?(F={height:"calc(300px)"},q=e=>{b(e.text)},l[9]=F,l[10]=q):(F=l[9],q=l[10]),l[11]!==_?(L=s.jsx(C,{className:"flex-1 -mt-4 mb-6",style:F,onChange:q,value:_,renderHTML:R,onImageUpload:S}),l[11]=_,l[12]=L):L=l[12],l[13]===Symbol.for("react.memo_cache_sentinel")?(M=s.jsx(n,{onClick:A,children:"取消"}),l[13]=M):M=l[13];const D="add"===u?"新增公告":"保存编辑";let E,H;return l[14]!==p||l[15]!==D?(E=s.jsxs("div",{className:"flex justify-end gap-3 flex-wrap",children:[M,s.jsx(n,{type:"primary",htmlType:"submit",loading:p,children:D})]}),l[14]=p,l[15]=D,l[16]=E):E=l[16],l[17]!==a||l[18]!==x||l[19]!==I||l[20]!==E||l[21]!==L?(H=s.jsx(s.Fragment,{children:s.jsxs(h,{form:x,autoComplete:"off",variant:"filled",initialValues:a,labelCol:T,onFinish:I,children:[O,z,L,E]})}),l[17]=a,l[18]=x,l[19]=I,l[20]=E,l[21]=L,l[22]=H):H=l[22],H};function R(e){return s.jsx(_,{content:e,replace:!1})}function A(){r.hide(c)}export{z as default};
