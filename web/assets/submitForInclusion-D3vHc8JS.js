import{r as e,h as l,l as r,n as o,S as s,V as a,v as t,j as i,bL as d,U as n,B as c,m,q as x,bD as u,cH as h,c as j,t as p,k as f,o as g}from"./requestIdleCallbackPolyfill-CVD_37F6.js";import{u as b}from"./useForm-LHSdzXb2.js";import{F as C}from"./index-G59xOF6l.js";import{I as y}from"./index-BANcGcmd.js";import{S as v}from"./index-DcfMndBI.js";import{R as w}from"./CloudUploadOutlined-DT2q3q8c.js";import{C as I}from"./ColorPicker-BN5Ue7zh.js";import{T as k}from"./index-BmB-0c7S.js";const{TextArea:P}=y;const N=e.memo(function(j){const{editItem:p,refresh:f,type:N="add"}=j,[T]=b(),[F,q]=e.useState([]),L=l(e=>e.stateUtils.categoryList).filter(e=>e&&0!==e.key).map(e=>({label:e.label,value:String(e.key)})),U=l(e=>e.user.token),V=l(e=>e.stateUtils.selectedCategoryId),[z,D]=e.useState(p),R=e.useCallback(e=>{r(1,q),o({url:"add"===N?g.submitWebsiteInfo:g.editWebsite,token:U,data:"add"===N?e:{...e,id:p.id}}).then(e=>{200===e.code&&("add"===N?(T.resetFields(),D(void 0)):s.hide(a),f&&f())}).finally(()=>{t(1,q)})},[]);return i.jsxs("main",{className:"mt-1",children:[i.jsx(S,{showItem:z}),i.jsxs(C,{labelCol:{flex:"82px"},form:T,initialValues:{backgroundColor:"#ffffff",fontColor:"#000000",...p,categoryId:"add"===N?"0"===V?void 0:V:String(p?.categoryId)},onFinish:e=>{e.icon&&(e.icon=h(e.icon,"https://")),e.url&&(e.url=h(e.url,"https://")),d(e.url)?(e.categoryId=Number(e.categoryId),R(e)):m.error("请输入正确的网站地址")},onValuesChange:e=>{e.backgroundColor&&T.setFieldValue("fontColor",u(e.backgroundColor)),setTimeout(()=>{D(T.getFieldsValue())},0)},children:[i.jsx(C.Item,{label:"网站地址",required:!0,name:"url",rules:[{validator:(e,l)=>l&&""!==l?d(l)?l.length>200?Promise.reject("网站地址不能超过200个字符"):Promise.resolve():Promise.reject("请输入正确的网站地址"):Promise.reject("请输入网站地址")}],children:i.jsx(y,{placeholder:"网站地址",allowClear:!0,maxLength:512})}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx(C.Item,{name:"title",label:"网站标题",required:!0,rules:[{validator:(e,l)=>l&&""!==l?l.length>50?Promise.reject("网站标题不能超过50个字符"):Promise.resolve():Promise.reject("请输入网站标题")}],children:i.jsx(y,{placeholder:"网站标题",allowClear:!0,maxLength:50})}),i.jsx(C.Item,{label:"所属分类",required:!0,className:"w-[320px]",name:"categoryId",rules:[{required:!0,message:"请选择网站分类"}],children:i.jsx(v,{options:L,allowClear:!0,placeholder:"所属分类"})})]}),i.jsx(C.Item,{label:"网站描述",required:!0,name:"description",rules:[{validator:(e,l)=>l&&""!==l?l.length>500?Promise.reject("网站描述不能超过200个字符"):Promise.resolve():Promise.reject("请输入网站描述")}],children:i.jsx(P,{placeholder:"请简要的描述网站主要内容，用于详情展示",autoSize:{minRows:2,maxRows:2},showCount:!0,allowClear:!0,maxLength:500})}),i.jsx(C.Item,{label:"网站图标",required:!0,name:"icon",rules:[{validator:(e,l)=>l&&""!==l?l&&l.length>200?Promise.reject("网站图标不能超过200个字符"):Promise.resolve():Promise.reject("请输入或上传网站图标")}],children:i.jsx(y,{placeholder:"网站图标（注：透明背景图标最佳）",addonAfter:i.jsx(n,{disabled:!U,accept:".png, .jpg, .jpeg, .svg, .webp, .ico",showUploadList:!1,beforeUpload:e=>e.size>204800?(m.error("图标大小不能超过200KB！"),!1):(r(0,q),o({url:g.uploadWebsiteInfoIcon,token:U,data:x({file:e})}).then(e=>{200===e.code&&e.data&&(T.setFieldValue("icon",e.data.icon_url),T.validateFields({dirty:!0}),D({...z,icon:e.data.icon_url}))}).finally(()=>{t(0,q)}),!1),children:i.jsx(c,{onClick:()=>{U||m.error("请您先完成登录/注册")},loading:F[0],type:"text",className:"rounded-none",children:"上传",icon:i.jsx(w,{})})}),allowClear:!0})}),i.jsxs("div",{className:"flex flex-wrap *:flex-1",children:[i.jsx(C.Item,{label:"背景颜色",name:"backgroundColor",normalize:e=>e.toHexString(),children:i.jsx(I,{showText:!0})}),i.jsx(C.Item,{label:"文字颜色",normalize:e=>e.toHexString(),name:"fontColor",children:i.jsx(I,{showText:!0})})]}),f&&i.jsx(C.Item,{label:"排序",name:"sort",children:i.jsx(k,{placeholder:"排序",min:0})}),i.jsxs("div",{className:"flex justify-end gap-3 flex-wrap",children:[i.jsx(c,{onClick:()=>{s.hide(a)},children:"取消"}),i.jsx(c,{type:"primary",htmlType:"submit",loading:F[1],children:"add"===N?"提交":"保存"})]})]})]})}),S=e.memo(e=>{const l=j.c(8),{showItem:r}=e,{token:o}=p.useToken(),s=`${o.colorFillSecondary}`;let a,t,d;return l[0]!==s?(a={backgroundColor:s,borderRadius:"6px",maxWidth:"calc(100vw - 80px)"},l[0]=s,l[1]=a):a=l[1],l[2]!==r||l[3]!==o.colorTextDescription?(t=r?.icon?i.jsx("div",{style:{backgroundColor:r?.backgroundColor},className:"w-9 h-9 rounded-md overflow-hidden",children:i.jsx("img",{src:f(r.icon),alt:"",className:"w-full h-full"})}):i.jsx("p",{style:{color:o.colorTextDescription},className:"font-medium h-9 flex-center",children:"预览区域，等待图标配置"}),l[2]=r,l[3]=o.colorTextDescription,l[4]=t):t=l[4],l[5]!==a||l[6]!==t?(d=i.jsx("div",{style:a,className:"mb-6 p-4 flex-center overflow-hidden",children:t}),l[5]=a,l[6]=t,l[7]=d):d=l[7],d});export{N as S};
