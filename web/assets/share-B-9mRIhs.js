const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/shareSay-B5FXhh7P.js","assets/main-Ce2ar2rV.js","assets/main-GNDb8orc.css"])))=>i.map(i=>d[i]);
import{r as e,c as t,i as a,k as s,j as l,F as n,w as i,L as r,D as o,ap as c,aq as d,B as h,E as m,G as u,z as p,C as x,H as f,am as j,aj as y,t as g,ag as S,dV as _,O as b,f3 as k,d as C,J as v,N as w,f4 as I,f5 as D,au as N,af as E,f6 as A,f7 as Y,aE as H,bI as L,cb as F,m as P,f8 as T,ab as V,l as z,ac as M,f9 as O,ah as U,a9 as $}from"./main-Ce2ar2rV.js";import{N as B}from"./noPermissions-CmMYXU21.js";import{E as q}from"./index-uPd5xO7J.js";import"./StepBackwardOutlined-DpwJRxU8.js";function G(){c.hide(d)}function J(e){return{label:e.label,value:e.id}}function R(e){return e.user.token}function Z(e){return e.appData.listData}const K=e.memo(function(u){const p=t.c(38),[x]=a(),{type:f,initialValues:j,setShareSettingData:y,setHasShare:g}=u,S=s(Z),_=s(R),[b,k]=e.useState(!1);let C;p[0]!==y||p[1]!==_?(C=function(e){k(!0),e.privateCategoryIds&&(e.privateCategoryIds=e.privateCategoryIds.join(",")),o({url:m.editShareSetting,data:e,token:_}).then(e=>{200===e.code&&e.data&&(y&&y(e.data),c.hide(d))}).finally(()=>{k(!1)})},p[0]=y,p[1]=_,p[2]=C):C=p[2];const v=C;let w;p[3]!==g||p[4]!==y||p[5]!==_?(w=function(e){k(!0),e.privateCategoryIds&&(e.privateCategoryIds=e.privateCategoryIds.join(",")),o({url:m.addShareSetting,data:e,token:_}).then(e=>{200===e.code&&e.data&&(y&&y(e.data),g&&g(!0),c.hide(d))}).finally(()=>{k(!1)})},p[3]=g,p[4]=y,p[5]=_,p[6]=w):w=p[6];const I=w;let D;p[7]!==x||p[8]!==j||p[9]!==S?(D=function(){if(!j||!j.privateCategoryIds)return;const e=[];j.privateCategoryIds.forEach(t=>{const a=S?.find(e=>e.id===t);a&&e.push(a.id)}),x.setFieldValue("privateCategoryIds",e)},p[7]=x,p[8]=j,p[9]=S,p[10]=D):D=p[10];const N=D;let E,A,Y,H,L,F,P,T,V,z,M,O;p[11]!==N?(E=()=>{N()},p[11]=N,p[12]=E):E=p[12],p[13]===Symbol.for("react.memo_cache_sentinel")?(A=[],p[13]=A):A=p[13],e.useEffect(E,A),p[14]===Symbol.for("react.memo_cache_sentinel")?(Y={flex:"72px"},p[14]=Y):Y=p[14],p[15]!==I||p[16]!==v||p[17]!==f?(H=e=>{"edit"===f?v(e):I(e)},p[15]=I,p[16]=v,p[17]=f,p[18]=H):H=p[18],p[19]===Symbol.for("react.memo_cache_sentinel")?(L=[{validator:(e,t)=>t&&""!==t?t&&!/^[a-zA-Z0-9]+$/.test(t)?Promise.reject("分享码仅限数字和英文"):Promise.resolve():Promise.reject("请输入分享码")}],p[19]=L):L=p[19],p[20]===Symbol.for("react.memo_cache_sentinel")?(F=l.jsx(n.Item,{label:"分享码",required:!0,rules:L,name:"path",children:l.jsx(i,{placeholder:"分享码",allowClear:!0,maxLength:50})}),p[20]=F):F=p[20],p[21]===Symbol.for("react.memo_cache_sentinel")?(P=l.jsx(n.Item,{name:"title",label:"标题名称",children:l.jsx(i,{placeholder:"分享页标题",allowClear:!0,maxLength:50})}),p[21]=P):P=p[21],p[22]===Symbol.for("react.memo_cache_sentinel")?(T=l.jsx(n.Item,{name:"description",label:"描述简介",children:l.jsx(i,{placeholder:"分享页描述",allowClear:!0,maxLength:200})}),p[22]=T):T=p[22],p[23]===Symbol.for("react.memo_cache_sentinel")?(V=l.jsx(n.Item,{name:"keywords",label:"关键词",children:l.jsx(i,{placeholder:"分享页关键词，SEO 使用",allowClear:!0,maxLength:200})}),p[23]=V):V=p[23],p[24]!==S?(z=S?.map(J),p[24]=S,p[25]=z):z=p[25],p[26]!==z?(M=l.jsx(n.Item,{name:"privateCategoryIds",label:"私有分类",children:l.jsx(r,{mode:"multiple",placeholder:"私有分类，分享时隐藏",options:z,allowClear:!0})}),p[26]=z,p[27]=M):M=p[27],p[28]===Symbol.for("react.memo_cache_sentinel")?(O=l.jsx(h,{onClick:G,children:"取消"}),p[28]=O):O=p[28];const U="edit"===f?"保存":"创建";let $,B;return p[29]!==b||p[30]!==U?($=l.jsxs("div",{className:"flex justify-end gap-3 flex-wrap",children:[O,l.jsx(h,{loading:b,htmlType:"submit",type:"primary",children:U})]}),p[29]=b,p[30]=U,p[31]=$):$=p[31],p[32]!==x||p[33]!==j||p[34]!==M||p[35]!==$||p[36]!==H?(B=l.jsx(l.Fragment,{children:l.jsxs(n,{form:x,initialValues:j,autoComplete:"off",labelCol:Y,onFinish:H,children:[F,P,T,V,M,$]})}),p[32]=x,p[33]=j,p[34]=M,p[35]=$,p[36]=H,p[37]=B):B=p[37],B});function Q(){c.hide(d)}function W(e){return l.jsx(y,{content:e,replace:!1})}function X(e){return e.user.token}const ee=e.memo(function(a){const n=t.c(34),{shareSettingData:i,setShareSettingData:r}=a,[y,g]=e.useState(i.share_say),S=s(X);let _;n[0]===Symbol.for("react.memo_cache_sentinel")?(_=[],n[0]=_):_=n[0];const[b,k]=e.useState(_);let C;n[1]!==S?(C=function(e){return new Promise(t=>{o({url:m.uploadImage,token:S,data:u({file:e})}).then(e=>{200===e.code&&e.data&&t(e.data.image_url)})})},n[1]=S,n[2]=C):C=n[2];const v=C;let w;n[3]!==y||n[4]!==r||n[5]!==i||n[6]!==S?(w=function(){y?(x(0,k),o({url:m.editShareSay,data:{shareSay:y},token:S}).then(e=>{200===e.code&&(r&&r({...i,share_say:y}),c.hide(d))}).finally(()=>{f(0,k)})):p.error("请输入分享有话的内容")},n[3]=y,n[4]=r,n[5]=i,n[6]=S,n[7]=w):w=n[7];const I=w;let D;n[8]!==r||n[9]!==i||n[10]!==S?(D=function(){x(1,k),o({url:m.resetShareSay,token:S}).then(e=>{200===e.code&&r&&(r({...i,share_say:""}),g(""))}).finally(()=>{f(1,k)})},n[8]=r,n[9]=i,n[10]=S,n[11]=D):D=n[11];const N=D;let E,A,Y,H,L,F,P,T,V,z;return n[12]===Symbol.for("react.memo_cache_sentinel")?(E={height:"calc(100% - 44px)"},A=e=>{g(e.text)},n[12]=E,n[13]=A):(E=n[12],A=n[13]),n[14]!==v||n[15]!==y?(Y=l.jsx(q,{className:"flex-1",style:E,onChange:A,value:y,renderHTML:W,onImageUpload:v}),n[14]=v,n[15]=y,n[16]=Y):Y=n[16],n[17]!==b[1]?(H=l.jsx(h,{danger:!0,loading:b[1],children:"重置"}),n[17]=b[1],n[18]=H):H=n[18],n[19]!==N||n[20]!==H?(L=l.jsx(j,{title:"是否确认重置？",onConfirm:N,children:H}),n[19]=N,n[20]=H,n[21]=L):L=n[21],n[22]===Symbol.for("react.memo_cache_sentinel")?(F=l.jsx(h,{onClick:Q,children:"取消"}),n[22]=F):F=n[22],n[23]!==I?(P=()=>{I()},n[23]=I,n[24]=P):P=n[24],n[25]!==b[0]||n[26]!==P?(T=l.jsx(h,{loading:b[0],type:"primary",onClick:P,children:"保存"}),n[25]=b[0],n[26]=P,n[27]=T):T=n[27],n[28]!==T||n[29]!==L?(V=l.jsxs("div",{className:"flex justify-end gap-3 flex-wrap",children:[L,F,T]}),n[28]=T,n[29]=L,n[30]=V):V=n[30],n[31]!==V||n[32]!==Y?(z=l.jsxs("div",{className:"flex flex-col gap-3 h-full",children:[Y,V]}),n[31]=V,n[32]=Y,n[33]=z):z=n[33],z}),te=E.lazy(()=>U(()=>import("./shareSay-B5FXhh7P.js"),__vite__mapDeps([0,1,2])));function ae(){const a=t.c(28),{token:n}=g.useToken(),i=s(ne);let r;a[0]===Symbol.for("react.memo_cache_sentinel")?(r=[],a[0]=r):r=a[0];const[u,p]=e.useState(r),y=s(le),E=s(se);let U;a[1]===Symbol.for("react.memo_cache_sentinel")?(U={path:"",title:"",description:"",keywords:"",CreatedAt:"",status:0,share_say:"",private_category_ids:"",UpdatedAt:""},a[1]=U):U=a[1];const[q,G]=e.useState(U),[J,R]=e.useState(!1);let Z;a[2]!==i?(Z=function(){i&&(x(0,p),$({url:m.getUserShare,token:i}).then(e=>{200===e.code&&e.data?(G(e.data),R(!0)):R(!1)}).finally(()=>{f(0,p)}))},a[2]=i,a[3]=Z):Z=a[3];const Q=Z;let W,X,ae;a[4]!==Q?(W=()=>{Q()},a[4]=Q,a[5]=W):W=a[5],a[6]===Symbol.for("react.memo_cache_sentinel")?(X=[],a[6]=X):X=a[6],e.useLayoutEffect(W,X),a[7]!==q||a[8]!==i?(ae=function(){x(1,p),o({url:m.enableShare,token:i}).then(e=>{200===e.code&&G({...q,status:1})}).finally(()=>{f(1,p)})},a[7]=q,a[8]=i,a[9]=ae):ae=a[9];const ie=ae;let re;a[10]!==q||a[11]!==i?(re=function(){x(2,p),o({url:m.disableShare,token:i}).then(e=>{200===e.code&&G({...q,status:2})}).finally(()=>{f(2,p)})},a[10]=q,a[11]=i,a[12]=re):re=a[12];const oe=re;let ce;a[13]!==i?(ce=function(){x(3,p),o({url:m.deleteShare,token:i}).then(e=>{200===e.code&&(G({path:"",title:"",description:"",keywords:"",CreatedAt:"",status:0,share_say:"",private_category_ids:"",UpdatedAt:""}),R(!1))}).finally(()=>{f(3,p)})},a[13]=i,a[14]=ce):ce=a[14];const de=ce;let he;a[15]!==y?(he=function(e){if(!e)return;const t=e.split(","),a=[];return t.forEach(e=>{const t=y?.find(t=>t.id===e);t&&a.push(t.label)}),a.join("，")},a[15]=y,a[16]=he):he=a[16];const me=he;let ue;return a[17]!==E||a[18]!==de||a[19]!==oe||a[20]!==ie||a[21]!==me||a[22]!==J||a[23]!==u||a[24]!==q||a[25]!==n||a[26]!==i?(ue=i?u[0]?l.jsx(S,{}):J?l.jsxs(l.Fragment,{children:[l.jsx(_,{message:"分享有话是以弱化提醒的方式展示在分享页的右上角抽屉中，支持自主自定义markdown显示内容！考虑性能，分享数据将缓存 5 分钟",type:"info",icon:l.jsx(b,{})}),l.jsx(k,{bordered:!0,column:1,className:"w-full",styles:{label:{padding:"8px 16px"},content:{padding:"8px 16px",textAlign:"end"}},items:[{label:"分享状态",children:l.jsx(v,{title:0===q.status?"请联系管理员或耐心等待审核通过":1===q.status?"您的分享页可正常访问":2===q.status?"您的分享页已暂停分享":3===q.status?"您的分享页因违规已被禁用":"",children:l.jsx(w,{className:"m-0 cursor-pointer",icon:l.jsx(b,{}),color:0===q.status?"default":1===q.status?"green":2===q.status?"orange":"red",children:0===q.status?"待审核":1===q.status?"正常":2===q.status?"已停用":"被禁用"})})},{label:"分享路径",children:q?.path?l.jsx("div",{className:"flex justify-end",children:l.jsx(h,{onClick:()=>{window.open(I+"/s/"+q?.path)},type:"link",size:"small",className:"min-h-[22px] h-full text-wrap p-0",children:l.jsx("span",{className:"text-end",children:I+"/s/"+q?.path||"-"})})}):"-"},{label:"私有分类",children:q.private_category_ids?me(q.private_category_ids):"-"},{label:"分享页标题",children:q?.title||"-"},{label:"分享页描述",children:q?.description||"-"},{label:"页面关键词",children:q?.keywords||"-"},{label:"分享有话",children:q.share_say?l.jsx("div",{className:"flex justify-end",children:l.jsx(h,{disabled:3===q.status,onClick:()=>{c.show(N,{title:"分享有话",backgroundOpacity:E?.92:void 0,children:l.jsx(e.Suspense,{children:l.jsx(te,{content:q.share_say||""})}),placement:"right"})},type:"link",className:"p-0 h-[22px]",size:"small",icon:l.jsx(D,{}),children:"预览"})}):"-"},{label:"创建时间",children:C(q?.CreatedAt).format("YYYY-MM-DD HH:mm:ss")||"-"},{label:"更新时间",children:C(q?.UpdatedAt).format("YYYY-MM-DD HH:mm:ss")||"-"}]}),3===q.status?null:l.jsxs("div",{className:"flex flex-col mt-3 gap-3",children:[l.jsxs("div",{className:"flex gap-1 font-medium pl-2",style:{color:n.colorTextDescription},children:[l.jsx(A,{}),l.jsx("p",{children:"控制台"})]}),l.jsx(h,{onClick:()=>{const e=""+(I+"/s/"+q?.path),t=q?.title,a=q?.description;H(`我的个性分享页：${e}${t?"（"+t+"）":""}${a?"，主要内容："+a:""}`)},icon:l.jsx(Y,{}),children:"复制文案"}),l.jsx(h,{icon:l.jsx(L,{}),onClick:()=>{c.show(d,{title:"有话设置",width:"860px",height:"520px",children:l.jsx(ee,{shareSettingData:q,setShareSettingData:G})})},children:"有话设置"}),l.jsx(h,{icon:l.jsx(F,{}),onClick:()=>{c.show(d,{title:"编辑分享信息",children:l.jsx(K,{type:"edit",initialValues:{path:q?.path,title:q?.title,description:q?.description,keywords:q?.keywords,privateCategoryIds:q?.private_category_ids.split(",")},setShareSettingData:G})})},children:"编辑信息"}),1===q.status?l.jsx(h,{onClick:oe,loading:u[2],icon:l.jsx(P,{}),children:"暂停分享"}):2===q.status?l.jsx(h,{onClick:ie,loading:u[1],icon:l.jsx(T,{}),children:"启用分享"}):null,l.jsx(j,{title:"是否确认删除？",onConfirm:de,children:l.jsx(h,{danger:!0,icon:l.jsx(V,{}),loading:u[3],children:"删除分享"})})]})]}):l.jsx(l.Fragment,{children:l.jsx(z,{className:"flex flex-col items-center w-full px-0",icon:l.jsx("div",{className:"h-[240px]",children:l.jsx("img",{alt:"",src:O,style:{width:"auto",height:"240px"}})}),title:l.jsx("div",{className:"flex justify-center w-full",children:l.jsx(h,{onClick:()=>{c.show(d,{title:"创建分享页",children:l.jsx(K,{type:"add",setShareSettingData:G,setHasShare:R})})},icon:l.jsx(M,{}),type:"primary",children:"创建分享页"})})})}):l.jsx(B,{title:"权限不足",subTitle:"请您先完成登录/注册",extra:!1}),a[17]=E,a[18]=de,a[19]=oe,a[20]=ie,a[21]=me,a[22]=J,a[23]=u,a[24]=q,a[25]=n,a[26]=i,a[27]=ue):ue=a[27],ue}function se(e){return e.card.bgBackdropFilter}function le(e){return e.appData.listData}function ne(e){return e.user.token}export{ae as default};
