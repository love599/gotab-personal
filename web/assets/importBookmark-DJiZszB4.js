import{u as e,g as l,r as a,t as s,a as t,x as r,w as o,y as i,m as n,z as d,S as c,V as m,F as u,G as p,j as x,B as j,cC as f,bJ as h,k as g,cD as b,H as C,J as w,q as k,l as v,U as y,o as F,v as I,E as S,bA as P,n as T}from"./requestIdleCallbackPolyfill-CEimuL3I.js";import{u as O}from"./useForm-BmxkZ3hM.js";import{P as N,T as V,x as L,z as q,U as D}from"./myFolderModal-DMVjguLH.js";import{b as z,a as B}from"./sortableJsUtils-lf51YuKZ.js";import{F as U}from"./index-CLs8asrc.js";import{I as R}from"./index-B6Nw0KJ3.js";import{S as A}from"./index-we7dqPR7.js";import{R as M}from"./index-CVsAKlSW.js";import{R as E}from"./CloudUploadOutlined-BcBaKmgs.js";import{C as H}from"./ColorPicker-gpVSsQlx.js";import{T as W}from"./index-BXpSMQ4p.js";import"./sortable.esm-DnfOC_F4.js";import"./iconBase-rh4uCQVo.js";import"./useFresh-CXjlCB9G.js";import"./index-Cu_iOCo3.js";import"./LeftOutlined-D9Sp279J.js";import"./FolderOpenOutlined-DHBkEw2_.js";import"./LinkOutlined-Bi0iQjOQ.js";import"./MailOutlined-OCY9FzYP.js";import"./Overflow-CysMCa0X.js";import"./mediaQueryUtil-DPPPwwPM.js";import"./myModal-DAb4Oxb9.js";import"./getAllowClear-Cn6nd0XC.js";import"./index-DG56vLGF.js";import"./useIsSmallScreen-DT9DQvvy.js";import"./LikeOutlined-BjYRMYG0.js";import"./ExportOutlined-BTrutQGh.js";import"./PlusOutlined-DoJ9MaWq.js";import"./PlusOutlined-ByZyTB3m.js";import"./index-BCD7T3lV.js";import"./ReloadOutlined-B00s2TmV.js";import"./LeftOutlined-DlW4zolN.js";import"./styleChecker-o73Q9rTs.js";import"./TextArea-D12ZTmOp.js";import"./addRecommendAppForm-K-4YO6EV.js";import"./fullSpin-CKQAqEpZ.js";import"./myDrawer2-BBz-Zjo8.js";import"./handleButton-FqbJIAiJ.js";import"./submitForInclusion-CIVbLdE7.js";import"./assets-B8Bi78Vh.js";import"./RedoOutlined-BRwewl8_.js";import"./SearchOutlined-C3PMWV9D.js";import"./Input-BBAEOKR8.js";import"./UserOutlined-Ch50gqEV.js";import"./QuestionCircleOutlined-Iab4W4Td.js";import"./QuestionCircleOutlined-DSm95oJP.js";import"./useBreakpoint-BCsgDtUx.js";import"./row-eYrfNDsp.js";import"./index-kH8S-jgo.js";const{useToken:J}=s,{TextArea:Q}=R;function _(s){const{item:_}=s,G=e(),$=l(e=>e.appData.listData),K=l(e=>e.swiper.showSwiper),X=l(e=>e.home.showFreeDrag),[Y,Z]=a.useState(null),[ee]=O(),{token:le}=J(),[ae,se]=a.useState(!1),[te,re]=a.useState("icon"),[oe,ie]=a.useState(_||{}),ne=l(e=>e.user.token),de=l(e=>e.swiper.activeIndex),ce=l(e=>e.card.defaultCardSize),me=l(e=>e.card.defaultCardShowType),ue=l(e=>e.card.defaultIconPadding),pe=l(e=>e.card.addCardDefaultBgColor),xe=l(e=>e.card.addCardDefaultFontColor),je=$[de].id,fe=a.useMemo(()=>$?.map(e=>({label:e.label,value:e.id})),[$]),he=a.useCallback(e=>{if(X&&!K){const l=t.getState().appData.freeDragListData,a=r(l).concat([{id:o(),type:"link",...e}]);G(i(a)),n.success("卡片已添加至自由拖拽区域")}else{const l=t.getState().appData.listData,a=z(r(l),je,{id:o(),type:"link",...e});G(d(a)),n.success("卡片添加完成")}c.hide(m)},[je,Y]),ge=a.useRef(null);a.useEffect(()=>()=>{ge.current&&clearTimeout(ge.current),ge.current=null},[]);const[be,Ce]=a.useState([]);return a.useEffect(()=>()=>{u()&&p({todo:"getWebsiteInfo",url:"cancel"})},[]),x.jsx("div",{className:"flex flex-wrap gap-3 justify-center",children:x.jsxs("div",{className:"flex-auto max-w-[640px]",children:[x.jsx(N,{showItem:oe}),x.jsxs(U,{id:"add-edit-link-card",form:ee,variant:"filled",autoComplete:"off",labelCol:{flex:"84px"},initialValues:{..._,link:_.url,label:_.title,size:ce||"11",openTarget:"globalSet",showType:me||"icon",backgroundColor:pe||"#ffffff",fontColor:xe||"#000000",iconPadding:ue||0},onFinish:e=>{e.icon&&(e.icon=f(e.icon,"https://")),e.link&&(e.link=f(e.link,"https://")),e.internalLink&&(e.internalLink=f(e.internalLink,"http://")),he(e)},onValuesChange:e=>{e.showType&&re(e.showType),e.backgroundColor&&ee.setFieldValue("fontColor",P(e.backgroundColor)),ge.current&&clearTimeout(ge.current),ge.current=setTimeout(()=>{ie(ee.getFieldsValue())},0)},children:[x.jsxs("div",{className:"flex gap-3 items-end",children:[x.jsx(U.Item,{className:"flex-1",label:"卡片链接",name:"link",required:!0,rules:[{required:!0,message:"请输入卡片链接"}],children:x.jsx(R,{maxLength:512,placeholder:"请输入卡片链接，默认安全链接（https://）",allowClear:!0,addonAfter:x.jsx(j,{onClick:async()=>{const e=ee.getFieldValue("link");if(!e)return void n.error("请输入卡片链接");const l=f(e,"https://");if(!h(l))return void n.error("请输入正确的卡片链接");const a=t.getState().home.getWebsiteInfoBy;if(u()&&"local"===a){g(1,Ce);const e=await p({todo:"getWebsiteInfo",url:l}),a=(new DOMParser).parseFromString(e,"text/html"),s=b(a,l);if(C(e)&&w(e)||""===s.title)return n.error("获取网站信息失败"),void k(1,Ce);let t="",r=!1;if(s.icon){const e=await p({todo:"uploadIcon",icon:s.icon});!e||C(e)&&w(e)?(r=!0,n.error("网站图标获取失败")):200===e.code&&e.data&&(t=e.data.faviconUrl)}ee.setFieldsValue({label:s.title,icon:t,backgroundColor:pe||"#ffffff",fontColor:xe||"#000000",description:s.description,iconPadding:ue||6}),ee.validateFields({dirty:!0}),ie(ee.getFieldsValue()),r||n.success("获取网站信息完成"),k(1,Ce)}else g(1,Ce),v({url:T.getWebsiteInfo,data:{url:l}}).then(e=>{200===e.code&&e.data&&(ee.setFieldValue("label",e.data.title||""),ee.setFieldValue("icon",e.data.icon||""),ee.setFieldValue("backgroundColor",e.data.backgroundColor||"#ffffff"),ee.setFieldValue("fontColor",e.data.fontColor||"#000000"),ee.setFieldValue("description",e.data.description||""),e.data.backgroundColor&&e.data.fontColor||ee.setFieldValue("iconPadding",6),ee.validateFields({dirty:!0}),setTimeout(()=>{ie(ee.getFieldsValue())},0))}).finally(()=>{k(1,Ce)})},loading:be[1],type:"text",className:"rounded-none",children:"获取信息",icon:x.jsx(V,{})})})}),x.jsx("div",{className:"flex items-center h-8 mb-6",children:x.jsx(L,{checked:ae,checkedChildren:"内网",onChange:e=>{se(e)},unCheckedChildren:"常规"})})]}),x.jsx(U.Item,{label:"内网链接",required:!0,rules:[{required:ae,message:"请输入内网链接"}],name:"internalLink",style:{display:ae?"":"none"},children:x.jsx(R,{placeholder:"请输入内网链接，默认普通链接（http://）",allowClear:!0,maxLength:512})}),x.jsxs("div",{className:"flex flex-wrap *:flex-1 gap-x-3",children:[x.jsx(U.Item,{label:"卡片名称",name:"label",required:!0,rules:[{validator:(e,l)=>l&&""!==l?l.length>100?Promise.reject("卡片名称不能超过100个字符"):Promise.resolve():Promise.reject("请输入卡片名称")}],children:x.jsx(R,{placeholder:"请输入卡片名称",allowClear:!0,maxLength:100})}),"icon-h"===te||"icon-v"===te?x.jsx(U.Item,{label:"卡片内标题",name:"innerlabel",rules:[{validator:(e,l)=>l&&l.length>100?Promise.reject("卡片内标题不能超过20个字符"):Promise.resolve()}],children:x.jsx(R,{placeholder:"若填写，将替换卡片名称显示",allowClear:!0,maxLength:20})}):null]}),x.jsx(U.Item,{label:"卡片大小",name:"size",className:"*:max-w-64",required:!0,rules:[{required:!0,message:"请选择卡片大小"}],children:x.jsx(A,{placeholder:"请选择卡片大小",options:q})}),x.jsx(U.Item,{label:"展示样式",name:"showType",required:!0,rules:[{required:!0,message:"请选择展示样式"}],children:x.jsxs(M.Group,{className:"ml-3",children:[x.jsx(M,{value:"icon",children:"纯图"}),x.jsx(M,{value:"text",children:"文本"}),x.jsx(M,{value:"icon-h",children:"横版"}),x.jsx(M,{value:"icon-v",children:"竖版"})]})}),x.jsx(U.Item,{label:"图标地址",name:"icon",required:!0,style:{display:"text"!==te?"":"none"},rules:[{validator:(e,l)=>"text"===te||l&&""!==l?l&&l.length>200?Promise.reject("网站图标不能超过200个字符"):Promise.resolve():Promise.reject("请获取或上传网站图标")}],children:x.jsx(R,{addonBefore:x.jsx(I,{title:"设为本地默认",destroyOnHidden:!0,children:x.jsx(j,{type:"text",className:"rounded-none",icon:x.jsx(B,{}),onClick:()=>{ee.setFieldValue("icon","/default/IeOutlined"),setTimeout(()=>{ie(ee.getFieldsValue())},0)}})}),placeholder:"请输入图标地址，默认安全链接（https://）",allowClear:!0,addonAfter:x.jsx(y,{disabled:!ne,accept:".png, .jpg, .jpeg, .svg, .webp, .ico",showUploadList:!1,beforeUpload:e=>e.size>204800?(n.error("图标大小不能超过200KB！"),!1):(g(0,Ce),v({url:T.uploadIcon,token:ne,data:F({file:e})}).then(e=>{200===e.code&&e.data&&(ee.setFieldValue("icon",e.data.icon_url),ee.validateFields({dirty:!0}),ie({...oe,icon:e.data.icon_url}))}).finally(()=>{k(0,Ce)}),!1),children:x.jsx(j,{onClick:()=>{ne||n.error("请您先完成登录/注册")},loading:be[0],type:"text",className:"rounded-none",children:"上传",icon:x.jsx(E,{})})})})}),x.jsx(U.Item,{label:"文本内容",name:"text",style:{display:"text"!==te?"none":""},rules:[{validator:(e,l)=>l&&l.length>100?Promise.reject("文本内容不能超过20个字符"):Promise.resolve()}],children:x.jsx(R,{placeholder:"请输入文本内容",maxLength:20,allowClear:!0})}),x.jsxs("div",{className:"flex flex-wrap *:flex-1 gap-x-3",children:[x.jsx(U.Item,{label:"背景颜色",name:"backgroundColor",normalize:e=>e.toHexString(),children:x.jsx(H,{showText:!0})}),x.jsx(U.Item,{label:"文字颜色",normalize:e=>e.toHexString(),name:"fontColor",children:x.jsx(H,{showText:!0})})]}),x.jsx(S,{className:"mt-0 text-sm",children:"更多配置"}),x.jsxs("div",{className:"flex flex-wrap *:flex-1 gap-x-3",children:[x.jsx(U.Item,{label:"打开方式",name:"openTarget",required:!0,rules:[{required:!0,message:"请选择打开方式"}],children:x.jsx(A,{options:D,className:"max-w-32"})}),x.jsx(U.Item,{label:"图标内间距",name:"iconPadding",children:x.jsx(W,{min:0,max:48,precision:0,placeholder:"图标内间距"})})]}),x.jsx(U.Item,{className:"mb-16",label:"描述/备注",name:"description",rules:[{validator:(e,l)=>l&&l.length>255?Promise.reject("卡片描述/备注不能超过200个字符"):Promise.resolve()}],children:x.jsx(Q,{autoSize:{minRows:2,maxRows:2},placeholder:"请输入卡片描述/备注",allowClear:!0,maxLength:200})}),x.jsxs("div",{className:"flex w-full justify-between flex-row-reverse gap-3 px-4 py-3 absolute left-0 bottom-0 z-10",style:{backgroundColor:le.colorBgContainer,borderTop:`1px solid ${le.colorBorderSecondary}`},children:[x.jsx(j,{onClick:()=>{Z("save"),setTimeout(()=>{ee.submit()},0)},type:"primary",children:"导入书签"}),K||!K&&!X?x.jsx(A,{options:fe,value:je,placeholder:"目标分组",className:"w-32 max-w-full",onChange:e=>{const l=$?.findIndex(l=>l.id===e),a=t.getState().stateUtils.mySwiper,s=t.getState().swiper.loop;-1!==l&&a&&(s?a.slideToLoop(l):a.slideTo(l))}}):null]})]})]})})}export{_ as default};
