import{r as e,e as t,c as o,u as r,k as n,t as l,bM as a,cW as s,cX as c,j as i,w as d,av as u,cY as f,o as m,cZ as p,c_ as x,q as g,c$ as h,d0 as b,d1 as w,a1 as k,d2 as y}from"./main-B_h69F6u.js";function v(e){const o=t.getState().card.gridColumnWidth,r=t.getState().card.gridRowHeight,n=e*(t.getState().card.radius/Math.min(r,o)),l=e/2;return Math.min(n,l)}function j(e,o){const r=t.getState().card.gridColumnWidth,n=t.getState().card.gridRowHeight;return e*(o/Math.min(n,r))}const S=e.memo(()=>{const f=o.c(28),m=r(),[p,x]=e.useState(!1),[g,v]=e.useState(!1),[j,S]=e.useState("");let N;f[0]===Symbol.for("react.memo_cache_sentinel")?(N=[],f[0]=N):N=f[0];const[E,L]=e.useState(N),[R,I]=e.useState(0),A=n(_),{token:M}=l.useToken(),B=e.useRef(null),z=e.useRef(null);let F,H,W;f[1]!==m||f[2]!==g?(F=()=>{g?(m(h(!1)),m(b(!1)),localStorage.setItem("globalSearchIsOpen","1")):(localStorage.removeItem("globalSearchIsOpen"),S(""),I(0))},H=[g,m],f[1]=m,f[2]=g,f[3]=F,f[4]=H):(F=f[3],H=f[4]),e.useEffect(F,H),f[5]===Symbol.for("react.memo_cache_sentinel")?(W=async o=>{if("string"!=typeof o)throw new Error("无效的关键词，请您提供有效的文本");if(!o)return void L([]);const r=t.getState().appData.listData,n=t.getState().appData.freeDragListData,l=[...w(r.concat(n)),...k()?await y():[]],a=new Set,s=l.filter(e=>"link"===e.type&&!a.has(e.link)&&(a.add(e.link),!0)).filter(e=>{if("link"===e.type&&e.label&&e.link){const t=e.label.trim().toLowerCase(),r=e.link.trim().toLowerCase();return t.includes(o.toLowerCase())||r.includes(o.toLowerCase())}return!1});e.startTransition(()=>{L(s.slice(0,9))})},f[5]=W):W=f[5];const P=W;let $,K,O,q;f[6]!==j?($=()=>{""!==j.trim()?P(j.trim()):L([])},K=[j,P],f[6]=j,f[7]=$,f[8]=K):($=f[7],K=f[8]),a($,K),f[9]===Symbol.for("react.memo_cache_sentinel")?(O=()=>{const e=e=>{(e.ctrlKey||e.metaKey)&&"f"===e.key&&(e.preventDefault(),v(!0),setTimeout(()=>x(!0),10))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},q=[],f[9]=O,f[10]=q):(O=f[9],q=f[10]),e.useEffect(O,q);const U=T,V=D;let X;f[11]===Symbol.for("react.memo_cache_sentinel")?(X=(e,t,o,r)=>{const{row:n,col:l}=V(e,o),a=Math.ceil(r/o);if("up"===t){const e=(0===n?a-1:n-1)*o+l;return e>=r?l:e}if("down"===t){const e=(n+1)%a*o+l;return e>=r?l:e}return e},f[11]=X):X=f[11];const Y=X;let Z,G,J;f[12]!==E||f[13]!==R||f[14]!==p?(G=()=>{if(!p||0===E.length)return;const e=e=>{const t=z.current;if(!t)return;const o=E.length,r=U(t);let n=R;e:switch(e.key){case"ArrowUp":e.preventDefault(),n=Y(R,"up",r,o);break e;case"ArrowDown":e.preventDefault(),n=Y(R,"down",r,o);break e;case"ArrowLeft":e.preventDefault(),n=(R-1+o)%o;break e;case"ArrowRight":e.preventDefault(),n=(R+1)%o;break e;case"Enter":R>=0&&window.open(E[R].link,"_blank");break e;default:return}I(n);const l=t.children[n];l&&l.scrollIntoView({block:"nearest",behavior:"smooth"})};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},Z=[p,E,R],f[12]=E,f[13]=R,f[14]=p,f[15]=Z,f[16]=G):(Z=f[15],G=f[16]),e.useEffect(G,Z),f[17]===Symbol.for("react.memo_cache_sentinel")?(J=()=>{x(!1),setTimeout(()=>v(!1),300)},f[17]=J):J=f[17];const Q=J;let ee,te;return s(B,Q),c("Escape",Q),f[18]!==A||f[19]!==E||f[20]!==R||f[21]!==g||f[22]!==p||f[23]!==j||f[24]!==M?(ee=g&&i.jsx("div",{className:`fixed inset-0 z-[10000] flex py-20 px-6 justify-center bg-black bg-opacity-45 opacity-0 transition-opacity duration-200 ${p?"opacity-100":""} ${A?"backdrop-blur-sm":""}`,children:i.jsxs("div",{ref:B,className:"flex flex-col p-6 gap-4 w-full max-w-xl transform h-fit max-h-full rounded-2xl opacity-0 transition-all duration-200 "+(p?"opacity-100":""),style:{background:M.colorBgContainer,scale:p?1:.9},children:[i.jsx(d,{size:"large",autoFocus:!0,className:"border-2",placeholder:"全局搜索链接/书签卡片（ 显示前 9 个相关结果 ）",prefix:i.jsx(u,{}),value:j,onChange:e=>{S(e.target.value),I(0)}}),i.jsx("div",{className:"h-full overflow-y-auto",children:E.length>0?i.jsx("div",{ref:z,className:"grid *:cursor-pointer *:transition-all *:duration-200 *:rounded-xl",style:{gridTemplateColumns:"repeat(auto-fill, minmax(160px, 1fr))",gap:"12px",gridAutoRows:"68px"},children:E.map((e,t)=>i.jsx(C,{result:e,index:t,currentIndex:R},e.id))}):i.jsx("div",{className:"p-6 pb-5 text-center",style:{color:M.colorTextDescription},children:j?"无搜索结果：请更换关键词":"请先输入您要搜索的关键词"})})]})}),f[18]=A,f[19]=E,f[20]=R,f[21]=g,f[22]=p,f[23]=j,f[24]=M,f[25]=ee):ee=f[25],f[26]!==ee?(te=i.jsx(i.Fragment,{children:ee}),f[26]=ee,f[27]=te):te=f[27],te}),C=e.memo(t=>{const r=o.c(39),{result:n,index:a,currentIndex:s}=t,c=l.useToken().token,d=e.useRef(null),u=f(d),h=n.id,b=a===s?c.colorPrimary:c.colorBorder,w=a===s?c.colorPrimaryBgHover:u?c.colorBgTextHover:void 0;let k,y;r[0]!==b||r[1]!==w?(k={borderColor:b,backgroundColor:w},r[0]=b,r[1]=w,r[2]=k):k=r[2],r[3]!==n.link?(y=()=>{window.open(n.link,"_blank")},r[3]=n.link,r[4]=y):y=r[4];const S=n.backgroundColor;let C;r[5]===Symbol.for("react.memo_cache_sentinel")?(C=v(40),r[5]=C):C=r[5];const _=n.iconPadding||0;let T,D,E,L,R,I,A,M,B,z,F;return r[6]!==_?(T=j(40,_),r[6]=_,r[7]=T):T=r[7],r[8]!==n.backgroundColor||r[9]!==T?(D={backgroundColor:S,borderRadius:C,padding:T},r[8]=n.backgroundColor,r[9]=T,r[10]=D):D=r[10],r[11]!==n.fontColor||r[12]!==n.icon||r[13]!==n.innerlabel||r[14]!==n.label?(E=n.icon?n.icon?.startsWith("/default/")?i.jsx(m,{style:{fontSize:24,color:n.fontColor}}):p(n.icon)?i.jsx("img",{src:g(n.icon),alt:n.label,style:{objectFit:"cover",borderRadius:v(25)},onError:N}):i.jsx(x,{icon:n.icon,className:"w-full h-full",fallback:i.jsx("img",{src:"/icons/default_image.svg",className:"w-full h-full object-contain"})}):i.jsx("span",{style:{fontSize:"10px",color:n.fontColor},className:"text-center font-medium",children:n.innerlabel||n.label}),r[11]=n.fontColor,r[12]=n.icon,r[13]=n.innerlabel,r[14]=n.label,r[15]=E):E=r[15],r[16]!==E||r[17]!==D?(L=i.jsx("div",{style:D,className:"w-10 h-10 flex items-center justify-center overflow-hidden",children:E}),r[16]=E,r[17]=D,r[18]=L):L=r[18],r[19]===Symbol.for("react.memo_cache_sentinel")?(R={width:"calc(100% - 40px - 8px)"},r[19]=R):R=r[19],r[20]!==c.colorText?(I={color:c.colorText},r[20]=c.colorText,r[21]=I):I=r[21],r[22]!==n.label||r[23]!==I?(A=i.jsx("div",{style:I,children:n.label}),r[22]=n.label,r[23]=I,r[24]=A):A=r[24],r[25]!==c.colorTextDescription?(M={color:c.colorTextDescription},r[25]=c.colorTextDescription,r[26]=M):M=r[26],r[27]!==n.link||r[28]!==M?(B=i.jsx("div",{style:M,className:"text-xs",children:n.link}),r[27]=n.link,r[28]=M,r[29]=B):B=r[29],r[30]!==A||r[31]!==B?(z=i.jsxs("div",{style:R,className:"font-medium *:truncate flex flex-col justify-evenly",children:[A,B]}),r[30]=A,r[31]=B,r[32]=z):z=r[32],r[33]!==n.id||r[34]!==L||r[35]!==z||r[36]!==k||r[37]!==y?(F=i.jsxs("div",{ref:d,className:"p-3 border-2 flex gap-2",style:k,onClick:y,children:[L,z]},h),r[33]=n.id,r[34]=L,r[35]=z,r[36]=k,r[37]=y,r[38]=F):F=r[38],F});function _(e){return e.card.bgBackdropFilter}function T(e){const t=Array.from(e.children);if(0===t.length)return 1;let o=1;const r=t[0].offsetTop;for(let n=1;n<t.length&&t[n].offsetTop===r;n++)o++;return o}function D(e,t){return{row:Math.floor(e/t),col:e%t}}function N(e){e.currentTarget.src="/icons/bookmark.svg"}export{S as default,v as getScaleRadius,j as getTruePadding};
