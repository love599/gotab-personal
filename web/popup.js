import{r as e,I as a,c as o,p as t,e as n,f as l,j as r,A as s,g as i,P as c,h as d,T as f,u,i as m,t as p,k as h,l as x,m as g,F as b,n as y,o as j,q as C,v as w,w as k,x as v,U as S,B as F,y as N,z as _,C as D,D as I,E as T,G as L,H as P,J as z,K as V,L as O,N as q,O as R,Q as B,V as U,W as E,X as W,Y as M,Z as G,_ as A,$ as H,a0 as K,a1 as X,a2 as Y,a3 as $,a4 as J,d as Q,s as Z,R as ee,b as ae}from"./assets/main-BcNz_jih.js";import{R as oe}from"./assets/RightSquareOutlined-CNc2yOfj.js";function te(){return te=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var o=arguments[a];for(var t in o)Object.prototype.hasOwnProperty.call(o,t)&&(e[t]=o[t])}return e},te.apply(this,arguments)}const ne=(o,t)=>e.createElement(a,te({},o,{ref:t,icon:oe})),le=e.forwardRef(ne);function re(){const a=o.c(4);let l,u,m,p;return a[0]===Symbol.for("react.memo_cache_sentinel")?(l=[],a[0]=l):l=a[0],e.useEffect(se,l),a[1]===Symbol.for("react.memo_cache_sentinel")?(u=t(n),a[1]=u):u=a[1],a[2]===Symbol.for("react.memo_cache_sentinel")?(m=r.jsx(s,{notification:{stack:{threshold:1}},children:r.jsx(i,{})}),a[2]=m):m=a[2],a[3]===Symbol.for("react.memo_cache_sentinel")?(p=r.jsx(c,{store:n,children:r.jsxs(d,{loading:null,persistor:u,children:[m,r.jsx(f,{children:r.jsx(ce,{})})]})}),a[3]=p):p=a[3],p}function se(){return ie}function ie(){l()}const ce=()=>{const a=o.c(51),t=u(),[l]=m(),[s,i]=e.useState(),{token:c}=p.useToken(),d=h(de),f=h(fe),[Q,Z]=e.useState(!1),ee="1"===localStorage.getItem("initOver"),ae=h(ue),oe=h(me),te=h(pe),ne=h(he),re=h(xe),se=h(ge),ie=h(be),ce=h(ye);let Fe;a[0]===Symbol.for("react.memo_cache_sentinel")?(Fe=[],a[0]=Fe):Fe=a[0];const[Ne,_e]=e.useState(Fe),[De,Ie]=e.useState(!1);let Te,Le;a[1]!==f?(Le=f?.map(je),a[1]=f,a[2]=Le):Le=a[2],Te=Le;const Pe=Te;let ze,Ve,Oe,qe,Re,Be;if(a[3]!==ie||a[4]!==ce||a[5]!==l||a[6]!==s){let Ke=function(e,a){D(0,_e),G({url:T.getWebsiteInfo2,data:{url:e}}).then(e=>{200===e.code&&e.data&&(l.setFieldValue("icon",e.data.icon||""),l.validateFields({dirty:!0}),e.data.backgroundColor&&e.data.fontColor?Ie(!0):Ie(!1),setTimeout(()=>{i({...s,icon:e.data.icon||"",backgroundColor:e.data.backgroundColor||ie||"#ffffff",fontColor:e.data.fontColor||ce||"#000000"}),P(0,_e)},0))}).catch(()=>{a?Ye(a):Xe(e)})},Xe=function(e){D(0,_e),I({url:T.getWebsiteInfo,data:{url:e}}).then(e=>{200===e.code&&e.data&&(l.setFieldValue("icon",e.data.icon||""),l.validateFields({dirty:!0}),e.data.backgroundColor&&e.data.fontColor?Ie(!0):Ie(!1),setTimeout(()=>{i({...s,icon:e.data.icon||"",backgroundColor:e.data.backgroundColor||ie||"#ffffff",fontColor:e.data.fontColor||ce||"#000000"})},0))}).finally(()=>{P(0,_e)})};async function Ye(e){D(0,_e);const a=n.getState().home.getWebsiteInfoBy;if(X()&&"local"===a){const a=await Y({todo:"uploadIcon",icon:e});if(!a||$(a)&&J(a))_.error("网站图标获取失败");else if(200===a.code&&a.data){const e=a.data.faviconUrl;l.setFieldValue("icon",e),Ie(!1),i({...s,icon:e,backgroundColor:ie||"#ffffff",fontColor:ce||"#000000"})}P(0,_e)}else G({url:T.uploadFavicon,data:{faviconUrl:e}}).then(e=>{200===e.code&&e.data&&(l.setFieldValue("icon",e.data.faviconUrl),Ie(!1),i({...s,icon:e.data.faviconUrl,backgroundColor:ie||"#ffffff",fontColor:ce||"#000000"}))}).catch(Ce).finally(()=>{P(0,_e)})}ze=function(){const e=document.location.protocol;"https:"!==e&&"http:"!==e?chrome.tabs.query({currentWindow:!0,active:!0},function(e){if(0!==e.length){const a=e[0];if(!a.url)return void Z(!0);Z(!1),Ke(a.url,a.favIconUrl),l.setFieldsValue({label:a.title,link:a.url}),i({...s,backgroundColor:ie||"#ffffff",fontColor:ce||"#000000",label:a.title,link:a.url})}}):Z(!0)},a[3]=ie,a[4]=ce,a[5]=l,a[6]=s,a[7]=ze}else ze=a[7];a[8]!==ze?(Ve=()=>{ee&&ze()},a[8]=ze,a[9]=Ve):Ve=a[9],a[10]===Symbol.for("react.memo_cache_sentinel")?(Oe=[],a[10]=Oe):Oe=a[10],e.useLayoutEffect(Ve,Oe),a[11]!==t?(qe=()=>{const e=document.location.protocol;if("https:"===e||"http:"===e)return;const a=(e,a)=>"updateListDataFromNewtab"===e.action?(t(M(e.payload)),!0):"updateFreeDragListDataFromNewtab"===e.action?(t(E(e.payload)),!0):void 0;return chrome.runtime.onMessage.addListener(a),()=>{chrome.runtime.onMessage.removeListener(a)}},a[11]=t,a[12]=qe):qe=a[12],a[13]===Symbol.for("react.memo_cache_sentinel")?(Re=[],a[13]=Re):Re=a[13],e.useEffect(qe,Re),a[14]!==t||a[15]!==re||a[16]!==se||a[17]!==ae||a[18]!==De||a[19]!==f||a[20]!==te||a[21]!==s||a[22]!==oe||a[23]!==d?(Be=function(e){const a=e.categoryId,o=n.getState().card.defaultCardSize,l=n.getState().card.defaultCardShowType,r=n.getState().card.defaultIconPadding;if(!oe&&te){delete e.categoryId;const a={...s,...e,id:B(),size:o||"11",type:"link",showType:s.icon?l||"icon":"text",x:re,y:se,iconPadding:r||De?0:6},n=U(ae).concat([a]);t(E(n)),_.success("卡片已添加至全屏自由拖拽"),setTimeout(()=>{try{chrome.runtime.sendMessage({action:"updateFreeDragListDataFromPopup",payload:n},we)}catch(e){}},0)}else{const n={...s,...e,id:B(),size:o||"11",type:"link",showType:s.icon?l||"icon":"text",iconPadding:r||De?0:6},i=W(U(f),a,n);t(M(i)),_.success("卡片添加完成"),setTimeout(()=>{try{chrome.runtime.sendMessage({action:"updateListDataFromPopup",payload:i},ke)}catch(e){}},0)}d&&G({url:T.pushData,data:{data:A(),timestamp:Date.now()},token:d}),D(2,_e)},a[14]=t,a[15]=re,a[16]=se,a[17]=ae,a[18]=De,a[19]=f,a[20]=te,a[21]=s,a[22]=oe,a[23]=d,a[24]=Be):Be=a[24];const Ue=Be;let Ee,We,Me,Ge,Ae,He;return a[25]!==c.colorBgContainer?(Ee={background:c.colorBgContainer},a[25]=c.colorBgContainer,a[26]=Ee):Ee=a[26],a[27]===Symbol.for("react.memo_cache_sentinel")?(We=r.jsx("img",{src:H,className:"w-[24px] h-[24px]"}),a[27]=We):We=a[27],a[28]===Symbol.for("react.memo_cache_sentinel")?(Me=r.jsxs("div",{className:"h-12 flex px-6 items-center justify-between",children:[We,r.jsx(F,{type:"link",className:"p-0",icon:r.jsx(le,{}),onClick:ve,children:"打开主页"})]}),Ge=r.jsx(K,{type:"horizontal",className:"m-0"}),a[28]=Me,a[29]=Ge):(Me=a[28],Ge=a[29]),a[30]!==ne||a[31]!==ie||a[32]!==ce||a[33]!==Pe||a[34]!==l||a[35]!==ze||a[36]!==De||a[37]!==Q||a[38]!==f||a[39]!==Ne||a[40]!==Ue||a[41]!==te||a[42]!==s||a[43]!==oe||a[44]!==c.colorFillSecondary||a[45]!==c.colorTextDescription||a[46]!==d?(Ae=r.jsx("main",{className:"p-6 h-[442px] flex flex-col overflow-scroll",children:ee?Q?r.jsx(x,{className:"p-0 pb-6 m-auto",title:"网站类型不支持",subTitle:"无法正确获取网站信息"}):Ne[2]?r.jsx(x,{status:"success",className:"p-0 pb-6 m-auto",title:"卡片添加成功",subTitle:"您已完成卡片添加，可选择关闭弹窗"}):r.jsxs(b,{labelCol:{flex:"82px"},form:l,initialValues:{categoryId:f[ne]?.id},layout:"horizontal",onFinish:Ue,onValuesChange:()=>{const e=l.getFieldsValue();i({...s,backgroundColor:ie||"#ffffff",fontColor:ce||"#000000",...e})},children:[r.jsx("div",{style:{backgroundColor:`${c.colorFillSecondary}`,borderRadius:"6px"},className:"mb-6 p-3 flex-center overflow-hidden",children:s?.label||s?.icon?r.jsx("div",{style:{backgroundColor:s?.backgroundColor||ie||"#ffffff",borderRadius:"12px",padding:De?0:6},className:"w-14 h-14 overflow-hidden flex-center",children:Ne[0]||Ne[1]?r.jsx(y,{spinning:!0}):s.icon?s.icon?.startsWith("/default/")?r.jsx(j,{style:{fontSize:40,color:s.fontColor||"#000000"}}):r.jsx("img",{src:C(s.icon),alt:"",className:"w-full h-full",onError:Se}):r.jsx("p",{style:{fontSize:w(s.label)>2?"14px":"18px"},className:"line-clamp-2 font-bold text-center w-full pt-[2px] break-words whitespace-break-spaces",children:s.label})}):r.jsx("p",{style:{color:c.colorTextDescription},className:"font-medium h-14 flex-center",children:"预览区域，等待图标配置"})}),r.jsx(b.Item,{required:!0,name:"link",rules:[{required:!0,message:"请输入卡片链接"}],children:r.jsx(k,{placeholder:"卡片链接",allowClear:!0,maxLength:512})}),r.jsx(b.Item,{name:"label",required:!0,rules:[{validator:(e,a)=>a&&""!==a?a.length>100?Promise.reject("卡片名称不能超过100个字符"):Promise.resolve():Promise.reject("请输入卡片名称")}],children:r.jsx(v,{placeholder:"卡片名称",allowClear:!0,maxLength:100,autoSize:{minRows:1,maxRows:1}})}),r.jsx(b.Item,{required:!0,name:"icon",rules:[{validator:(e,a)=>a&&""!==a&&a&&a.length>200?Promise.reject("网站图标不能超过200个字符"):Promise.resolve()}],children:r.jsx(k,{addonBefore:r.jsx(z,{title:"设为本地默认",destroyOnHidden:!0,children:r.jsx(F,{type:"text",className:"rounded-none",icon:r.jsx(V,{}),onClick:()=>{l.setFieldValue("icon","/default/IeOutlined"),l.validateFields({dirty:!0}),i({...s,icon:"/default/IeOutlined",backgroundColor:ie||"#ffffff",fontColor:ce||"#000000"})}})}),addonAfter:r.jsx(S,{disabled:!d,accept:".png, .jpg, .jpeg, .svg, .webp, .ico",showUploadList:!1,beforeUpload:e=>e.size>204800?(_.error("图标大小不能超过200KB！"),!1):(D(1,_e),I({url:T.uploadIcon,token:d,data:L({file:e})}).then(e=>{200===e.code&&e.data&&(l.setFieldValue("icon",e.data.icon_url),l.validateFields({dirty:!0}),i({...s,icon:e.data.icon_url,backgroundColor:ie||"#ffffff",fontColor:ce||"#000000"}))}).finally(()=>{P(1,_e)}),!1),children:r.jsx(F,{onClick:()=>{d||_.error("请您先完成登录/注册")},loading:Ne[0],type:"text",className:"rounded-none",children:"上传",icon:r.jsx(N,{})})}),placeholder:"图标地址（注：透明背景图标最佳）",allowClear:!0})}),r.jsx(b.Item,{required:!0,name:"categoryId",rules:[{required:!0,message:"请选择目标分组"}],children:r.jsx(O,{disabled:!oe&&te,options:Pe,allowClear:!0,placeholder:"目标分组"})}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx(F,{className:"w-full",disabled:Ne[0]||Ne[1]||Ne[2],onClick:()=>{ze()},children:"重新获取信息"}),r.jsx(F,{className:"w-full",type:"primary",htmlType:"submit",loading:Ne[0]||Ne[1],disabled:Ne[2],children:Ne[0]?"正在获取图标":Ne[1]?"正在上传图标":"保存卡片信息"})]}),r.jsx(q,{className:"w-full mt-3",icon:r.jsx(R,{}),children:"更多配置请移步至主页编辑卡片，快捷方式暂不支持"})]}):r.jsx(x,{icon:r.jsx(g,{}),className:"p-0 pb-6 m-auto",title:"插件尚未初始化",subTitle:"请您先打开插件主页完成数据初始化"})}),a[30]=ne,a[31]=ie,a[32]=ce,a[33]=Pe,a[34]=l,a[35]=ze,a[36]=De,a[37]=Q,a[38]=f,a[39]=Ne,a[40]=Ue,a[41]=te,a[42]=s,a[43]=oe,a[44]=c.colorFillSecondary,a[45]=c.colorTextDescription,a[46]=d,a[47]=Ae):Ae=a[47],a[48]!==Ae||a[49]!==Ee?(He=r.jsxs("div",{className:"w-[360px] h-[488px]",style:Ee,children:[Me,Ge,Ae]}),a[48]=Ae,a[49]=Ee,a[50]=He):He=a[50],He};function de(e){return e.user.token}function fe(e){return e.appData.listData}function ue(e){return e.appData.freeDragListData}function me(e){return e.swiper.showSwiper}function pe(e){return e.home.showFreeDrag}function he(e){return e.swiper.activeIndex}function xe(e){return e.home.freeDragGridX}function ge(e){return e.home.freeDragGridY}function be(e){return e.card.addCardDefaultBgColor}function ye(e){return e.card.addCardDefaultFontColor}function je(e){return{label:e.label,value:e.id}}function Ce(){_.error("网站图标保存失败")}function we(e){}function ke(e){}function ve(){window.open(window.location.origin+"/newtab.html","_blank")}function Se(e){e.currentTarget.src="/icons/default_image.svg"}Q.locale("zh-cn"),Z(!1),ee.createRoot(document.body).render(window.location.protocol.includes("http")?r.jsx(ae,{}):r.jsx(re,{}));
