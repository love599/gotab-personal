import{r as e,I as t,c as o,p as a,a as s,b as r,j as n,A as l,e as i,P as c,f as d,T as f,u,t as m,g as p,h,i as j,U as x,B as g,m as b,k as y,l as C,n as w,o as k,q as v,v as S,w as F,x as I,y as D,z as N,C as O,D as _,E as T,F as P,G as R,H as L,J as q,d as z,s as U,R as B}from"./assets/requestIdleCallbackPolyfill-CEimuL3I.js";import V from"./assets/myErrorPage-CLr4Hszv.js";import{u as E}from"./assets/useForm-BmxkZ3hM.js";import{T as M}from"./assets/TextArea-D12ZTmOp.js";import{R as W,g as A,a as G,b as Q}from"./assets/sortableJsUtils-lf51YuKZ.js";import{l as H}from"./assets/assets-B8Bi78Vh.js";import{R as J}from"./assets/StopOutlined-BiZS3bI8.js";import{F as K}from"./assets/index-CLs8asrc.js";import{S as X}from"./assets/index-BCD7T3lV.js";import{I as Y}from"./assets/index-B6Nw0KJ3.js";import{R as $}from"./assets/CloudUploadOutlined-BcBaKmgs.js";import{S as Z}from"./assets/index-we7dqPR7.js";import{T as ee}from"./assets/index-DG56vLGF.js";import{R as te}from"./assets/QuestionCircleOutlined-Iab4W4Td.js";import{R as oe}from"./assets/RightSquareOutlined-CNc2yOfj.js";import"./assets/getAllowClear-Cn6nd0XC.js";import"./assets/handleButton-FqbJIAiJ.js";import"./assets/LikeOutlined-BjYRMYG0.js";import"./assets/MailOutlined-OCY9FzYP.js";import"./assets/Overflow-CysMCa0X.js";import"./assets/FolderOpenOutlined-DHBkEw2_.js";import"./assets/SearchOutlined-C3PMWV9D.js";import"./assets/Input-BBAEOKR8.js";import"./assets/myModal-DAb4Oxb9.js";import"./assets/PlusOutlined-ByZyTB3m.js";import"./assets/fullSpin-CKQAqEpZ.js";import"./assets/useBreakpoint-BCsgDtUx.js";import"./assets/mediaQueryUtil-DPPPwwPM.js";import"./assets/StopOutlined-Br6dl6xU.js";import"./assets/row-eYrfNDsp.js";import"./assets/QuestionCircleOutlined-DSm95oJP.js";function ae(){return ae=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(e[a]=o[a])}return e},ae.apply(this,arguments)}const se=(o,a)=>e.createElement(t,ae({},o,{ref:a,icon:oe})),re=e.forwardRef(se);function ne(){const t=o.c(4);let r,u,m,p;return t[0]===Symbol.for("react.memo_cache_sentinel")?(r=[],t[0]=r):r=t[0],e.useEffect(le,r),t[1]===Symbol.for("react.memo_cache_sentinel")?(u=a(s),t[1]=u):u=t[1],t[2]===Symbol.for("react.memo_cache_sentinel")?(m=n.jsx(l,{notification:{stack:{threshold:1}},children:n.jsx(i,{})}),t[2]=m):m=t[2],t[3]===Symbol.for("react.memo_cache_sentinel")?(p=n.jsx(c,{store:s,children:n.jsxs(d,{loading:null,persistor:u,children:[m,n.jsx(f,{children:n.jsx(ce,{})})]})}),t[3]=p):p=t[3],p}function le(){return ie}function ie(){r()}const ce=()=>{const t=o.c(51),a=u(),[r]=E(),[l,i]=e.useState(),{token:c}=m.useToken(),d=p(de),f=p(fe),[z,U]=e.useState(!1),B="1"===localStorage.getItem("initOver"),V=p(ue),oe=p(me),ae=p(pe),se=p(he),ne=p(je),le=p(xe),ie=p(ge),ce=p(be);let Se;t[0]===Symbol.for("react.memo_cache_sentinel")?(Se=[],t[0]=Se):Se=t[0];const[Fe,Ie]=e.useState(Se),[De,Ne]=e.useState(!1);let Oe,_e;t[1]!==f?(_e=f?.map(ye),t[1]=f,t[2]=_e):_e=t[2],Oe=_e;const Te=Oe;let Pe,Re,Le,qe,ze,Ue;if(t[3]!==ie||t[4]!==ce||t[5]!==r||t[6]!==l){let Qe=function(e,t){y(0,Ie),O({url:w.getWebsiteInfo2,data:{url:e}}).then(e=>{200===e.code&&e.data&&(r.setFieldValue("icon",e.data.icon||""),r.validateFields({dirty:!0}),e.data.backgroundColor&&e.data.fontColor?Ne(!0):Ne(!1),setTimeout(()=>{i({...l,icon:e.data.icon||"",backgroundColor:e.data.backgroundColor||ie||"#ffffff",fontColor:e.data.fontColor||ce||"#000000"}),v(0,Ie)},0))}).catch(()=>{t?Je(t):He(e)})},He=function(e){y(0,Ie),C({url:w.getWebsiteInfo,data:{url:e}}).then(e=>{200===e.code&&e.data&&(r.setFieldValue("icon",e.data.icon||""),r.validateFields({dirty:!0}),e.data.backgroundColor&&e.data.fontColor?Ne(!0):Ne(!1),setTimeout(()=>{i({...l,icon:e.data.icon||"",backgroundColor:e.data.backgroundColor||ie||"#ffffff",fontColor:e.data.fontColor||ce||"#000000"})},0))}).finally(()=>{v(0,Ie)})};async function Je(e){y(0,Ie);const t=s.getState().home.getWebsiteInfoBy;if(P()&&"local"===t){const t=await R({todo:"uploadIcon",icon:e});if(!t||L(t)&&q(t))b.error("网站图标获取失败");else if(200===t.code&&t.data){const e=t.data.faviconUrl;r.setFieldValue("icon",e),Ne(!1),i({...l,icon:e,backgroundColor:ie||"#ffffff",fontColor:ce||"#000000"})}v(0,Ie)}else O({url:w.uploadFavicon,data:{faviconUrl:e}}).then(e=>{200===e.code&&e.data&&(r.setFieldValue("icon",e.data.faviconUrl),Ne(!1),i({...l,icon:e.data.faviconUrl,backgroundColor:ie||"#ffffff",fontColor:ce||"#000000"}))}).catch(Ce).finally(()=>{v(0,Ie)})}Pe=function(){const e=document.location.protocol;"https:"!==e&&"http:"!==e?chrome.tabs.query({currentWindow:!0,active:!0},function(e){if(0!==e.length){const t=e[0];if(!t.url)return void U(!0);U(!1),Qe(t.url,t.favIconUrl),r.setFieldsValue({label:t.title,link:t.url}),i({...l,backgroundColor:ie||"#ffffff",fontColor:ce||"#000000",label:t.title,link:t.url})}}):U(!0)},t[3]=ie,t[4]=ce,t[5]=r,t[6]=l,t[7]=Pe}else Pe=t[7];t[8]!==Pe?(Re=()=>{B&&Pe()},t[8]=Pe,t[9]=Re):Re=t[9],t[10]===Symbol.for("react.memo_cache_sentinel")?(Le=[],t[10]=Le):Le=t[10],e.useLayoutEffect(Re,Le),t[11]!==a?(qe=()=>{const e=document.location.protocol;if("https:"===e||"http:"===e)return;const t=(e,t)=>"updateListDataFromNewtab"===e.action?(a(N(e.payload)),!0):"updateFreeDragListDataFromNewtab"===e.action?(a(D(e.payload)),!0):void 0;return chrome.runtime.onMessage.addListener(t),()=>{chrome.runtime.onMessage.removeListener(t)}},t[11]=a,t[12]=qe):qe=t[12],t[13]===Symbol.for("react.memo_cache_sentinel")?(ze=[],t[13]=ze):ze=t[13],e.useEffect(qe,ze),t[14]!==a||t[15]!==ne||t[16]!==le||t[17]!==V||t[18]!==De||t[19]!==f||t[20]!==ae||t[21]!==l||t[22]!==oe||t[23]!==d?(Ue=function(e){const t=e.categoryId,o=s.getState().card.defaultCardSize,r=s.getState().card.defaultCardShowType,n=s.getState().card.defaultIconPadding;if(!oe&&ae){delete e.categoryId;const t={...l,...e,id:F(),size:o||"11",type:"link",showType:l.icon?r||"icon":"text",x:ne,y:le,iconPadding:n||De?0:6},s=I(V).concat([t]);a(D(s)),b.success("卡片已添加至全屏自由拖拽"),setTimeout(()=>{try{chrome.runtime.sendMessage({action:"updateFreeDragListDataFromPopup",payload:s},we)}catch(e){}},0)}else{const s={...l,...e,id:F(),size:o||"11",type:"link",showType:l.icon?r||"icon":"text",iconPadding:n||De?0:6},i=Q(I(f),t,s);a(N(i)),b.success("卡片添加完成"),setTimeout(()=>{try{chrome.runtime.sendMessage({action:"updateListDataFromPopup",payload:i},ke)}catch(e){}},0)}d&&O({url:w.pushData,data:{data:_(),timestamp:Date.now()},token:d}),y(2,Ie)},t[14]=a,t[15]=ne,t[16]=le,t[17]=V,t[18]=De,t[19]=f,t[20]=ae,t[21]=l,t[22]=oe,t[23]=d,t[24]=Ue):Ue=t[24];const Be=Ue;let Ve,Ee,Me,We,Ae,Ge;return t[25]!==c.colorBgContainer?(Ve={background:c.colorBgContainer},t[25]=c.colorBgContainer,t[26]=Ve):Ve=t[26],t[27]===Symbol.for("react.memo_cache_sentinel")?(Ee=n.jsx("img",{src:H,className:"w-[24px] h-[24px]"}),t[27]=Ee):Ee=t[27],t[28]===Symbol.for("react.memo_cache_sentinel")?(Me=n.jsxs("div",{className:"h-12 flex px-6 items-center justify-between",children:[Ee,n.jsx(g,{type:"link",className:"p-0",icon:n.jsx(re,{}),onClick:ve,children:"打开主页"})]}),We=n.jsx(T,{type:"horizontal",className:"m-0"}),t[28]=Me,t[29]=We):(Me=t[28],We=t[29]),t[30]!==se||t[31]!==ie||t[32]!==ce||t[33]!==Te||t[34]!==r||t[35]!==Pe||t[36]!==De||t[37]!==z||t[38]!==f||t[39]!==Fe||t[40]!==Be||t[41]!==ae||t[42]!==l||t[43]!==oe||t[44]!==c.colorFillSecondary||t[45]!==c.colorTextDescription||t[46]!==d?(Ae=n.jsx("main",{className:"p-6 h-[442px] flex flex-col overflow-scroll",children:B?z?n.jsx(h,{className:"p-0 pb-6 m-auto",title:"网站类型不支持",subTitle:"无法正确获取网站信息"}):Fe[2]?n.jsx(h,{status:"success",className:"p-0 pb-6 m-auto",title:"卡片添加成功",subTitle:"您已完成卡片添加，可选择关闭弹窗"}):n.jsxs(K,{labelCol:{flex:"82px"},form:r,initialValues:{categoryId:f[se]?.id},layout:"horizontal",onFinish:Be,onValuesChange:()=>{const e=r.getFieldsValue();i({...l,backgroundColor:ie||"#ffffff",fontColor:ce||"#000000",...e})},children:[n.jsx("div",{style:{backgroundColor:`${c.colorFillSecondary}`,borderRadius:"6px"},className:"mb-6 p-3 flex-center overflow-hidden",children:l?.label||l?.icon?n.jsx("div",{style:{backgroundColor:l?.backgroundColor||ie||"#ffffff",borderRadius:"12px",padding:De?0:6},className:"w-14 h-14 overflow-hidden flex-center",children:Fe[0]||Fe[1]?n.jsx(X,{spinning:!0}):l.icon?l.icon?.startsWith("/default/")?n.jsx(W,{style:{fontSize:40,color:l.fontColor||"#000000"}}):n.jsx("img",{src:j(l.icon),alt:"",className:"w-full h-full"}):n.jsx("p",{style:{fontSize:A(l.label)>2?"14px":"18px"},className:"line-clamp-2 font-bold text-center w-full pt-[2px] break-words whitespace-break-spaces",children:l.label})}):n.jsx("p",{style:{color:c.colorTextDescription},className:"font-medium h-14 flex-center",children:"预览区域，等待图标配置"})}),n.jsx(K.Item,{required:!0,name:"link",rules:[{required:!0,message:"请输入卡片链接"}],children:n.jsx(Y,{placeholder:"卡片链接",allowClear:!0,maxLength:512})}),n.jsx(K.Item,{name:"label",required:!0,rules:[{validator:(e,t)=>t&&""!==t?t.length>100?Promise.reject("卡片名称不能超过100个字符"):Promise.resolve():Promise.reject("请输入卡片名称")}],children:n.jsx(M,{placeholder:"卡片名称",allowClear:!0,maxLength:100,autoSize:{minRows:1,maxRows:1}})}),n.jsx(K.Item,{required:!0,name:"icon",rules:[{validator:(e,t)=>t&&""!==t&&t&&t.length>200?Promise.reject("网站图标不能超过200个字符"):Promise.resolve()}],children:n.jsx(Y,{addonBefore:n.jsx(S,{title:"设为本地默认",destroyOnHidden:!0,children:n.jsx(g,{type:"text",className:"rounded-none",icon:n.jsx(G,{}),onClick:()=>{r.setFieldValue("icon","/default/IeOutlined"),r.validateFields({dirty:!0}),i({...l,icon:"/default/IeOutlined",backgroundColor:ie||"#ffffff",fontColor:ce||"#000000"})}})}),addonAfter:n.jsx(x,{disabled:!d,accept:".png, .jpg, .jpeg, .svg, .webp, .ico",showUploadList:!1,beforeUpload:e=>e.size>204800?(b.error("图标大小不能超过200KB！"),!1):(y(1,Ie),C({url:w.uploadIcon,token:d,data:k({file:e})}).then(e=>{200===e.code&&e.data&&(r.setFieldValue("icon",e.data.icon_url),r.validateFields({dirty:!0}),i({...l,icon:e.data.icon_url,backgroundColor:ie||"#ffffff",fontColor:ce||"#000000"}))}).finally(()=>{v(1,Ie)}),!1),children:n.jsx(g,{onClick:()=>{d||b.error("请您先完成登录/注册")},loading:Fe[0],type:"text",className:"rounded-none",children:"上传",icon:n.jsx($,{})})}),placeholder:"图标地址（注：透明背景图标最佳）",allowClear:!0})}),n.jsx(K.Item,{required:!0,name:"categoryId",rules:[{required:!0,message:"请选择目标分组"}],children:n.jsx(Z,{disabled:!oe&&ae,options:Te,allowClear:!0,placeholder:"目标分组"})}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx(g,{className:"w-full",disabled:Fe[0]||Fe[1]||Fe[2],onClick:()=>{Pe()},children:"重新获取信息"}),n.jsx(g,{className:"w-full",type:"primary",htmlType:"submit",loading:Fe[0]||Fe[1],disabled:Fe[2],children:Fe[0]?"正在获取图标":Fe[1]?"正在上传图标":"保存卡片信息"})]}),n.jsx(ee,{className:"w-full mt-3",icon:n.jsx(te,{}),children:"更多配置请移步至主页编辑卡片，快捷方式暂不支持"})]}):n.jsx(h,{icon:n.jsx(J,{}),className:"p-0 pb-6 m-auto",title:"插件尚未初始化",subTitle:"请您先打开插件主页完成数据初始化"})}),t[30]=se,t[31]=ie,t[32]=ce,t[33]=Te,t[34]=r,t[35]=Pe,t[36]=De,t[37]=z,t[38]=f,t[39]=Fe,t[40]=Be,t[41]=ae,t[42]=l,t[43]=oe,t[44]=c.colorFillSecondary,t[45]=c.colorTextDescription,t[46]=d,t[47]=Ae):Ae=t[47],t[48]!==Ae||t[49]!==Ve?(Ge=n.jsxs("div",{className:"w-[360px] h-[488px]",style:Ve,children:[Me,We,Ae]}),t[48]=Ae,t[49]=Ve,t[50]=Ge):Ge=t[50],Ge};function de(e){return e.user.token}function fe(e){return e.appData.listData}function ue(e){return e.appData.freeDragListData}function me(e){return e.swiper.showSwiper}function pe(e){return e.home.showFreeDrag}function he(e){return e.swiper.activeIndex}function je(e){return e.home.freeDragGridX}function xe(e){return e.home.freeDragGridY}function ge(e){return e.card.addCardDefaultBgColor}function be(e){return e.card.addCardDefaultFontColor}function ye(e){return{label:e.label,value:e.id}}function Ce(){b.error("网站图标保存失败")}function we(e){}function ke(e){}function ve(){window.open(window.location.origin+"/newtab.html","_blank")}z.locale("zh-cn"),U(!1),B.createRoot(document.body).render(window.location.protocol.includes("http")?n.jsx(V,{}):n.jsx(ne,{}));
