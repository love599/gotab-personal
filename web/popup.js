import{r as e,I as o,c as t,p as a,a as s,b as r,e as n,j as l,A as i,f as c,P as d,g as f,T as u,u as m,t as p,h,i as x,k as j,U as g,B as b,m as y,l as C,n as w,o as k,q as v,v as S,w as F,x as I,y as D,z as N,C as _,D as T,E as O,F as P,G as R,H as U,J as q,K as z,d as B,s as L,R as V}from"./assets/requestIdleCallbackPolyfill-DEU4BPbw.js";import E from"./assets/myErrorPage-DsxLAAIG.js";import{u as M}from"./assets/useForm-DIX_a_7G.js";import{T as W}from"./assets/TextArea-BWz4jIx5.js";import{R as A,g as G,a as Q,b as H}from"./assets/sortableJsUtils-DdMBrLfa.js";import{l as J}from"./assets/assets-B8Bi78Vh.js";import{u as K}from"./assets/useBeforeUnload-Cc4kpjzf.js";import{R as X}from"./assets/StopOutlined-Cu0svjdK.js";import{F as Y}from"./assets/index-9tneyI6F.js";import{S as $}from"./assets/index-DxFe-Rzl.js";import{I as Z}from"./assets/index-RraZpeV0.js";import{R as ee}from"./assets/CloudUploadOutlined-dj2yaw2G.js";import{S as oe}from"./assets/index-4gSYBMW8.js";import{T as te}from"./assets/index-FChzs3Dd.js";import{R as ae}from"./assets/QuestionCircleOutlined-DYq9aeCI.js";import{R as se}from"./assets/RightSquareOutlined-CNc2yOfj.js";import"./assets/getAllowClear-BCigCKPi.js";import"./assets/handleButton-BUippp21.js";import"./assets/fullSpin-fN8_UlM1.js";import"./assets/myModal-Dg1f_8Rb.js";import"./assets/useBreakpoint-CMTnf1Wp.js";import"./assets/mediaQueryUtil-DPPPwwPM.js";import"./assets/StopOutlined-Br6dl6xU.js";import"./assets/row-CzejJH_c.js";import"./assets/QuestionCircleOutlined-DSm95oJP.js";import"./assets/Input-Dx5M-rij.js";import"./assets/Overflow-BQO2PO8P.js";function re(){return re=Object.assign?Object.assign.bind():function(e){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},re.apply(this,arguments)}const ne=(t,a)=>e.createElement(o,re({},t,{ref:a,icon:se})),le=e.forwardRef(ne);function ie(){const o=t.c(4);let r,n,m,p;return K(fe,""),o[0]===Symbol.for("react.memo_cache_sentinel")?(r=[],o[0]=r):r=o[0],e.useEffect(ce,r),o[1]===Symbol.for("react.memo_cache_sentinel")?(n=a(s),o[1]=n):n=o[1],o[2]===Symbol.for("react.memo_cache_sentinel")?(m=l.jsx(i,{notification:{stack:{threshold:1}},children:l.jsx(c,{})}),o[2]=m):m=o[2],o[3]===Symbol.for("react.memo_cache_sentinel")?(p=l.jsx(d,{store:s,children:l.jsxs(f,{loading:null,persistor:n,children:[m,l.jsx(u,{children:l.jsx(ue,{})})]})}),o[3]=p):p=o[3],p}function ce(){return de}function de(){n()}function fe(){return r(),!1}const ue=()=>{const o=t.c(51),a=m(),[r]=M(),[n,i]=e.useState(),{token:c}=p.useToken(),d=h(me),f=h(pe),[u,B]=e.useState(!1),L="1"===localStorage.getItem("initOver"),V=h(he),E=h(xe),K=h(je),se=h(ge),re=h(be),ne=h(ye),ie=h(Ce),ce=h(we);let de;o[0]===Symbol.for("react.memo_cache_sentinel")?(de=[],o[0]=de):de=o[0];const[fe,ue]=e.useState(de),[De,Ne]=e.useState(!1);let _e,Te;o[1]!==f?(Te=f?.map(ke),o[1]=f,o[2]=Te):Te=o[2],_e=Te;const Oe=_e;let Pe,Re,Ue,qe,ze,Be;if(o[3]!==ie||o[4]!==ce||o[5]!==r||o[6]!==n){let Qe=function(e,o){C(0,ue),T({url:k.getWebsiteInfo2,data:{url:e}}).then(e=>{200===e.code&&e.data&&(r.setFieldValue("icon",e.data.icon||""),r.validateFields({dirty:!0}),e.data.backgroundColor&&e.data.fontColor?Ne(!0):Ne(!1),setTimeout(()=>{i({...n,icon:e.data.icon||"",backgroundColor:e.data.backgroundColor||ie||"#ffffff",fontColor:e.data.fontColor||ce||"#000000"}),S(0,ue)},0))}).catch(()=>{o?Je(o):He(e)})},He=function(e){C(0,ue),w({url:k.getWebsiteInfo,data:{url:e}}).then(e=>{200===e.code&&e.data&&(r.setFieldValue("icon",e.data.icon||""),r.validateFields({dirty:!0}),e.data.backgroundColor&&e.data.fontColor?Ne(!0):Ne(!1),setTimeout(()=>{i({...n,icon:e.data.icon||"",backgroundColor:e.data.backgroundColor||ie||"#ffffff",fontColor:e.data.fontColor||ce||"#000000"})},0))}).finally(()=>{S(0,ue)})};async function Je(e){C(0,ue);const o=s.getState().home.getWebsiteInfoBy;if(R()&&"local"===o){const o=await U({todo:"uploadIcon",icon:e});if(!o||q(o)&&z(o))y.error("网站图标获取失败");else if(200===o.code&&o.data){const e=o.data.faviconUrl;r.setFieldValue("icon",e),Ne(!1),i({...n,icon:e,backgroundColor:ie||"#ffffff",fontColor:ce||"#000000"})}S(0,ue)}else T({url:k.uploadFavicon,data:{faviconUrl:e}}).then(e=>{200===e.code&&e.data&&(r.setFieldValue("icon",e.data.faviconUrl),Ne(!1),i({...n,icon:e.data.faviconUrl,backgroundColor:ie||"#ffffff",fontColor:ce||"#000000"}))}).catch(ve).finally(()=>{S(0,ue)})}Pe=function(){const e=document.location.protocol;"https:"!==e&&"http:"!==e?chrome.tabs.query({currentWindow:!0,active:!0},function(e){if(0!==e.length){const o=e[0];if(!o.url)return void B(!0);B(!1),Qe(o.url,o.favIconUrl),r.setFieldsValue({label:o.title,link:o.url}),i({...n,backgroundColor:ie||"#ffffff",fontColor:ce||"#000000",label:o.title,link:o.url})}}):B(!0)},o[3]=ie,o[4]=ce,o[5]=r,o[6]=n,o[7]=Pe}else Pe=o[7];o[8]!==Pe?(Re=()=>{L&&Pe()},o[8]=Pe,o[9]=Re):Re=o[9],o[10]===Symbol.for("react.memo_cache_sentinel")?(Ue=[],o[10]=Ue):Ue=o[10],e.useLayoutEffect(Re,Ue),o[11]!==a?(qe=()=>{const e=document.location.protocol;if("https:"===e||"http:"===e)return;const o=(e,o)=>"updateListDataFromNewtab"===e.action?(a(_(e.payload)),!0):"updateFreeDragListDataFromNewtab"===e.action?(a(N(e.payload)),!0):void 0;return chrome.runtime.onMessage.addListener(o),()=>{chrome.runtime.onMessage.removeListener(o)}},o[11]=a,o[12]=qe):qe=o[12],o[13]===Symbol.for("react.memo_cache_sentinel")?(ze=[],o[13]=ze):ze=o[13],e.useEffect(qe,ze),o[14]!==a||o[15]!==re||o[16]!==ne||o[17]!==V||o[18]!==De||o[19]!==f||o[20]!==K||o[21]!==n||o[22]!==E||o[23]!==d?(Be=function(e){const o=e.categoryId,t=s.getState().card.defaultCardSize,r=s.getState().card.defaultCardShowType,l=s.getState().card.defaultIconPadding;if(!E&&K){delete e.categoryId;const o={...n,...e,id:I(),size:t||"11",type:"link",showType:n.icon?r||"icon":"text",x:re,y:ne,iconPadding:l||De?0:6},s=D(V).concat([o]);a(N(s)),y.success("卡片已添加至全屏自由拖拽"),setTimeout(()=>{try{chrome.runtime.sendMessage({action:"updateFreeDragListDataFromPopup",payload:s},Se)}catch(e){}},0)}else{const s={...n,...e,id:I(),size:t||"11",type:"link",showType:n.icon?r||"icon":"text",iconPadding:l||De?0:6},i=H(D(f),o,s);a(_(i)),y.success("卡片添加完成"),setTimeout(()=>{try{chrome.runtime.sendMessage({action:"updateListDataFromPopup",payload:i},Fe)}catch(e){}},0)}d&&T({url:k.pushData,data:{data:O(),timestamp:Date.now()},token:d}),C(2,ue)},o[14]=a,o[15]=re,o[16]=ne,o[17]=V,o[18]=De,o[19]=f,o[20]=K,o[21]=n,o[22]=E,o[23]=d,o[24]=Be):Be=o[24];const Le=Be;let Ve,Ee,Me,We,Ae,Ge;return o[25]!==c.colorBgContainer?(Ve={background:c.colorBgContainer},o[25]=c.colorBgContainer,o[26]=Ve):Ve=o[26],o[27]===Symbol.for("react.memo_cache_sentinel")?(Ee=l.jsx("img",{src:J,className:"w-[24px] h-[24px]"}),o[27]=Ee):Ee=o[27],o[28]===Symbol.for("react.memo_cache_sentinel")?(Me=l.jsxs("div",{className:"h-12 flex px-6 items-center justify-between",children:[Ee,l.jsx(b,{type:"link",className:"p-0",icon:l.jsx(le,{}),onClick:Ie,children:"打开主页"})]}),We=l.jsx(P,{type:"horizontal",className:"m-0"}),o[28]=Me,o[29]=We):(Me=o[28],We=o[29]),o[30]!==se||o[31]!==ie||o[32]!==ce||o[33]!==Oe||o[34]!==r||o[35]!==Pe||o[36]!==De||o[37]!==u||o[38]!==f||o[39]!==fe||o[40]!==Le||o[41]!==K||o[42]!==n||o[43]!==E||o[44]!==c.colorFillSecondary||o[45]!==c.colorTextDescription||o[46]!==d?(Ae=l.jsx("main",{className:"p-6 h-[442px] flex flex-col overflow-scroll",children:L?u?l.jsx(x,{className:"p-0 pb-6 m-auto",title:"网站类型不支持",subTitle:"无法正确获取网站信息"}):fe[2]?l.jsx(x,{status:"success",className:"p-0 pb-6 m-auto",title:"卡片添加成功",subTitle:"您已完成卡片添加，可选择关闭弹窗"}):l.jsxs(Y,{labelCol:{flex:"82px"},form:r,initialValues:{categoryId:f[se]?.id},layout:"horizontal",onFinish:Le,onValuesChange:()=>{const e=r.getFieldsValue();i({...n,backgroundColor:ie||"#ffffff",fontColor:ce||"#000000",...e})},children:[l.jsx("div",{style:{backgroundColor:`${c.colorFillSecondary}`,borderRadius:"6px"},className:"mb-6 p-3 flex-center overflow-hidden",children:n?.label||n?.icon?l.jsx("div",{style:{backgroundColor:n?.backgroundColor||ie||"#ffffff",borderRadius:"12px",padding:De?0:6},className:"w-14 h-14 overflow-hidden flex-center",children:fe[0]||fe[1]?l.jsx($,{spinning:!0}):n.icon?n.icon?.startsWith("/default/")?l.jsx(A,{style:{fontSize:40,color:n.fontColor||"#000000"}}):l.jsx("img",{src:j(n.icon),alt:"",className:"w-full h-full"}):l.jsx("p",{style:{fontSize:G(n.label)>2?"14px":"18px"},className:"line-clamp-2 font-bold text-center w-full pt-[2px] break-words whitespace-break-spaces",children:n.label})}):l.jsx("p",{style:{color:c.colorTextDescription},className:"font-medium h-14 flex-center",children:"预览区域，等待图标配置"})}),l.jsx(Y.Item,{required:!0,name:"link",rules:[{required:!0,message:"请输入卡片链接"}],children:l.jsx(Z,{placeholder:"卡片链接",allowClear:!0,maxLength:512})}),l.jsx(Y.Item,{name:"label",required:!0,rules:[{validator:(e,o)=>o&&""!==o?o.length>100?Promise.reject("卡片名称不能超过100个字符"):Promise.resolve():Promise.reject("请输入卡片名称")}],children:l.jsx(W,{placeholder:"卡片名称",allowClear:!0,maxLength:100,autoSize:{minRows:1,maxRows:1}})}),l.jsx(Y.Item,{required:!0,name:"icon",rules:[{validator:(e,o)=>o&&""!==o&&o&&o.length>200?Promise.reject("网站图标不能超过200个字符"):Promise.resolve()}],children:l.jsx(Z,{addonBefore:l.jsx(F,{title:"设为本地默认",destroyOnHidden:!0,children:l.jsx(b,{type:"text",className:"rounded-none",icon:l.jsx(Q,{}),onClick:()=>{r.setFieldValue("icon","/default/IeOutlined"),r.validateFields({dirty:!0}),i({...n,icon:"/default/IeOutlined",backgroundColor:ie||"#ffffff",fontColor:ce||"#000000"})}})}),addonAfter:l.jsx(g,{disabled:!d,accept:".png, .jpg, .jpeg, .svg, .webp, .ico",showUploadList:!1,beforeUpload:e=>e.size>204800?(y.error("图标大小不能超过200KB！"),!1):(C(1,ue),w({url:k.uploadIcon,token:d,data:v({file:e})}).then(e=>{200===e.code&&e.data&&(r.setFieldValue("icon",e.data.icon_url),r.validateFields({dirty:!0}),i({...n,icon:e.data.icon_url,backgroundColor:ie||"#ffffff",fontColor:ce||"#000000"}))}).finally(()=>{S(1,ue)}),!1),children:l.jsx(b,{onClick:()=>{d||y.error("请您先完成登录/注册")},loading:fe[0],type:"text",className:"rounded-none",children:"上传",icon:l.jsx(ee,{})})}),placeholder:"图标地址（注：透明背景图标最佳）",allowClear:!0})}),l.jsx(Y.Item,{required:!0,name:"categoryId",rules:[{required:!0,message:"请选择目标分组"}],children:l.jsx(oe,{disabled:!E&&K,options:Oe,allowClear:!0,placeholder:"目标分组"})}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx(b,{className:"w-full",disabled:fe[0]||fe[1]||fe[2],onClick:()=>{Pe()},children:"重新获取信息"}),l.jsx(b,{className:"w-full",type:"primary",htmlType:"submit",loading:fe[0]||fe[1],disabled:fe[2],children:fe[0]?"正在获取图标":fe[1]?"正在上传图标":"保存卡片信息"})]}),l.jsx(te,{className:"w-full mt-3",icon:l.jsx(ae,{}),children:"更多配置请移步至主页编辑卡片，快捷方式暂不支持"})]}):l.jsx(x,{icon:l.jsx(X,{}),className:"p-0 pb-6 m-auto",title:"插件尚未初始化",subTitle:"请您先打开插件主页完成数据初始化"})}),o[30]=se,o[31]=ie,o[32]=ce,o[33]=Oe,o[34]=r,o[35]=Pe,o[36]=De,o[37]=u,o[38]=f,o[39]=fe,o[40]=Le,o[41]=K,o[42]=n,o[43]=E,o[44]=c.colorFillSecondary,o[45]=c.colorTextDescription,o[46]=d,o[47]=Ae):Ae=o[47],o[48]!==Ae||o[49]!==Ve?(Ge=l.jsxs("div",{className:"w-[360px] h-[488px]",style:Ve,children:[Me,We,Ae]}),o[48]=Ae,o[49]=Ve,o[50]=Ge):Ge=o[50],Ge};function me(e){return e.user.token}function pe(e){return e.appData.listData}function he(e){return e.appData.freeDragListData}function xe(e){return e.swiper.showSwiper}function je(e){return e.home.showFreeDrag}function ge(e){return e.swiper.activeIndex}function be(e){return e.home.freeDragGridX}function ye(e){return e.home.freeDragGridY}function Ce(e){return e.card.addCardDefaultBgColor}function we(e){return e.card.addCardDefaultFontColor}function ke(e){return{label:e.label,value:e.id}}function ve(){y.error("网站图标保存失败")}function Se(e){}function Fe(e){}function Ie(){window.open(window.location.origin+"/newtab.html","_blank")}B.locale("zh-cn"),L(!1),V.createRoot(document.body).render(window.location.protocol.includes("http")?l.jsx(E,{}):l.jsx(ie,{}));
